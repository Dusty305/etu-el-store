//src\api\admin.js
// src/api/admin.js
import { SERVER_ADDRESS, handleResponse } from "./utils.js";

export const API_BASE = 'api/admin';

export const adminAPI = {
    async getUsers(page = 1, limit = 10, search = '') {
        const params = new URLSearchParams({ page, limit, search });
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/users?${params}`, {
            credentials: 'include'
        });
        return handleResponse(response);
    },

    async updateUserRole(userId, role) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/users/${userId}/role`, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ role }),
            credentials: 'include'
        });
        return handleResponse(response);
    }
};

export const adminCategoriesAPI = {
    async createCategory(categoryData) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/categories`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(categoryData),
            credentials: 'include'
        });
        return handleResponse(response);
    },

    async updateCategory(categoryId, categoryData) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/categories/${categoryId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(categoryData),
            credentials: 'include'
        });
        return handleResponse(response);
    },

    async deleteCategory(categoryId) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/categories/${categoryId}`, {
            method: 'DELETE',
            credentials: 'include'
        });
        return handleResponse(response);
    },

    async getCategoryTree() {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/categories/tree`, {
            credentials: 'include'
        });
        return handleResponse(response);
    }
};
//src\api\auth.js
import { SERVER_ADDRESS, handleResponse } from "./utils.js";

export const API_BASE = 'api/auth';


export const authAPI = {
    async login(credentials) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/login`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(credentials),
            credentials: 'include'
        });

        return handleResponse(response);
    },

    async register(userData) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/register`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(userData),
            credentials: 'include'
        });

        return handleResponse(response);
    },

    async logout() {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/logout`, {
            method: 'POST',
            credentials: 'include'
        });

        return handleResponse(response);
    },

    async getCurrentUser() {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/me`, {
            credentials: 'include'
        });

        return handleResponse(response);
    }
};
//src\api\cart.js
import { SERVER_ADDRESS, handleResponse } from "./utils.js";

export const API_BASE = 'api/cart';

export const cartAPI = {
    async getCart() {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}`, {
            credentials: 'include'
        });
        return handleResponse(response);
    },

    async addToCart(productId, quantity = 1) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ productId, quantity }),
            credentials: 'include'
        });
        return handleResponse(response);
    },

    async updateCartItem(productId, quantity) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/${productId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ quantity }),
            credentials: 'include'
        });
        return handleResponse(response);
    },

    async removeFromCart(productId) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/${productId}`, {
            method: 'DELETE',
            credentials: 'include'
        });
        return handleResponse(response);
    },

    async clearCart() {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}`, {
            method: 'DELETE',
            credentials: 'include'
        });
        return handleResponse(response);
    }
};
//src\api\orders.js
import { SERVER_ADDRESS, handleResponse } from "./utils.js";

export const API_BASE = 'api/orders';

export const ordersAPI = {
    async createOrder(orderData) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(orderData),
            credentials: 'include'
        });
        return handleResponse(response);
    },

    async getOrders(page = 1, limit = 10, status = '') {
        const params = new URLSearchParams({ page, limit });
        if (status) params.append('status', status);

        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}?${params}`, {
            credentials: 'include'
        });
        return handleResponse(response);
    },

    async getOrder(orderId) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/${orderId}`, {
            credentials: 'include'
        });
        return handleResponse(response);
    },

    async updateOrder(orderId, orderData) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/${orderId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(orderData),
            credentials: 'include'
        });
        return handleResponse(response);
    },

    async payOrder(orderId, paymentData) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/${orderId}/pay`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(paymentData),
            credentials: 'include'
        });
        return handleResponse(response);
    },

    async cancelOrder(orderId) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/${orderId}/cancel`, {
            method: 'POST',
            credentials: 'include'
        });
        return handleResponse(response);
    },

    async deliverOrder(orderId) {
        const response = await fetch(`${SERVER_ADDRESS}/${API_BASE}/${orderId}/deliver`, {
            method: 'POST',
            credentials: 'include'
        });
        return handleResponse(response);
    }
};
//src\api\product.js
import { SERVER_ADDRESS, handleResponse } from "./utils.js";

export const API_BASE = 'api/product';

const handle_fetch = async (req) => {
    const response = await fetch(`${SERVER_ADDRESS}/${req}`);
    return handleResponse(response);
}

export const productAPI = {
    async getAllProducts() { return handle_fetch(`${API_BASE}/all`) },

    async getOneProduct(productId) { return handle_fetch(`${API_BASE}/id/${productId}`) },

    async getProductsFromCategories(categories) {
        return handle_fetch(`${API_BASE}/search?c=${categories.join(',')}`)
    },

    async findProducts(searchString, categories) {
        return handle_fetch(`${API_BASE}/search?w=${searchString}&c=${categories.join(',')}`)
    },
};
//src\api\utils.js
export const SERVER_ADDRESS = 'http://localhost:5000'

export async function handleResponse(response) {
    if (!response.ok) {
        const errorData = await response.json().catch(() => ({ error: 'Network error' }));
        throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
    }
    return response.json();
}
//src\App.vue
<template>
  <div id="app">
    <router-view />
  </div>
</template>

<script setup>
import {onBeforeMount} from 'vue';
import { useAuthStore } from './stores/auth.js';

const authStore = useAuthStore();

onBeforeMount(async () => {
  await authStore.checkAuth();
});
</script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  line-height: 1.6;
  color: #333;
}

#app {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}
</style>
//src\components\admin\CategoryTreeNode.vue
<template>
  <div class="category-tree-node" :style="{ marginLeft: `${level * 20}px` }">
    <div class="category-item" :class="{ 'editing': isEditing }">
      <div class="category-content">
        <span class="category-name" v-if="!isEditing">
          {{ category.name }}
        </span>

        <div v-else class="edit-form">
          <BaseInput
              v-model="editForm.name"
              placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
              class="edit-input"
          />
          <select v-model="editForm.parentCategory" class="parent-select">
            <option :value="null">–ö–æ—Ä–Ω–µ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</option>
            <option
                v-for="cat in availableParents"
                :key="cat._id"
                :value="cat._id"
                :disabled="cat._id === category._id"
            >
              {{ getCategoryPath(cat) }}
            </option>
          </select>
        </div>

        <span class="category-info" v-if="!isEditing">
          (ID: {{ category._id }})
        </span>
      </div>

      <div class="category-actions" v-if="!isEditing">
        <BaseButton
            @click="startEditing"
            variant="outline"
            size="small"
            title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
        >
          ‚úèÔ∏è
        </BaseButton>
        <BaseButton
            @click="handleDelete"
            variant="outline"
            size="small"
            title="–£–¥–∞–ª–∏—Ç—å"
            class="delete-btn"
        >
          üóëÔ∏è
        </BaseButton>
      </div>

      <div class="edit-actions" v-else>
        <BaseButton
            @click="saveEdit"
            variant="primary"
            size="small"
            :disabled="!editForm.name.trim()"
        >
          üíæ
        </BaseButton>
        <BaseButton
            @click="cancelEdit"
            variant="outline"
            size="small"
        >
          ‚ùå
        </BaseButton>
      </div>
    </div>

    <div v-if="category.children && category.children.length > 0" class="category-children">
      <CategoryTreeNode
          v-for="child in category.children"
          :key="child._id"
          :category="child"
          :level="level + 1"
          :allCategories="allCategories"
          @category-updated="(...args) => $emit('category-updated', ...args)"
          @category-deleted="(...args) => $emit('category-deleted', ...args)"
      />
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';
import BaseInput from '../ui/BaseInput.vue';
import BaseButton from '../ui/BaseButton.vue';

const props = defineProps({
  category: {
    type: Object,
    required: true
  },
  level: {
    type: Number,
    default: 0
  },
  allCategories: {
    type: Array,
    default: () => []
  }
});

const emit = defineEmits(['category-updated', 'category-deleted']);

const isEditing = ref(false);
const editForm = ref({
  name: '',
  parentCategory: null
});

// –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–≤—Å–µ –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–π –∏ –µ–µ –ø–æ—Ç–æ–º–∫–æ–≤)
const availableParents = computed(() => {
  const excludeIds = new Set();
  const collectIds = (cat) => {
    excludeIds.add(cat._id);
    if (cat.children) {
      cat.children.forEach(collectIds);
    }
  };
  collectIds(props.category);

  return props.allCategories.filter(cat => !excludeIds.has(cat._id));
});

const getCategoryPath = (category, path = '') => {
  if (!category.parentCategory) return category.name;

  const parent = props.allCategories.find(cat => cat._id === category.parentCategory);
  if (!parent) return category.name;

  return `${getCategoryPath(parent)} ‚Üí ${category.name}`;
};

const startEditing = () => {
  editForm.value = {
    name: props.category.name,
    parentCategory: props.category.parentCategory
  };
  isEditing.value = true;
};

const cancelEdit = () => {
  isEditing.value = false;
  editForm.value = {
    name: '',
    parentCategory: null
  };
};

const saveEdit = async () => {
  if (!editForm.value.name.trim()) return;

  emit('category-updated', {
    categoryId: props.category._id,
    data: editForm.value
  });
  isEditing.value = false;
};

const handleDelete = () => {
  if (confirm(`–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${props.category.name}"? –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ.`)) {
    emit('category-deleted', props.category._id);
  }
};
</script>

<style scoped>
.category-tree-node {
  margin-bottom: 0.5rem;
}

.category-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem;
  background: #f8f9fa;
  border-radius: 6px;
  border: 1px solid #dee2e6;
  transition: all 0.2s;
}

.category-item.editing {
  background: #e7f3ff;
  border-color: #007bff;
}

.category-content {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.category-name {
  font-weight: 600;
  font-size: 1rem;
}

.category-info {
  color: #6c757d;
  font-size: 0.875rem;
}

.edit-form {
  display: flex;
  gap: 1rem;
  align-items: center;
  flex: 1;
}

.edit-input {
  flex: 1;
  margin-bottom: 0;
}

.parent-select {
  padding: 0.5rem;
  border: 1px solid #ddd;
  border-radius: 4px;
  min-width: 200px;
}

.category-actions, .edit-actions {
  display: flex;
  gap: 0.5rem;
}

.delete-btn {
  color: #dc3545;
  border-color: #dc3545;
}

.delete-btn:hover {
  background: #dc3545;
  color: white;
}

.category-children {
  margin-top: 0.5rem;
  border-left: 2px solid #e9ecef;
  padding-left: 1rem;
}
</style>
//src\components\auth\AuthModal.vue
<template>
  <BaseModal :isOpen="isOpen" @close="handleClose">
    <component
        :is="currentComponent"
        @success="handleSuccess"
        @switch-to-login="switchToLogin"
        @switch-to-register="switchToRegister"
    />
  </BaseModal>
</template>

<script setup>
import { ref, computed } from 'vue';
import { useAuthStore } from '../../stores/auth.js';
import BaseModal from '../ui/BaseModal.vue';
import LoginForm from '../auth/LoginForm.vue';
import RegisterForm from '../auth/RegisterForm.vue';

const props = defineProps({
  isOpen: {
    type: Boolean,
    required: true
  },
  initialMode: {
    type: String,
    default: 'login',
    validator: (value) => ['login', 'register'].includes(value)
  }
});

const emit = defineEmits(['close', 'success']);

const authStore = useAuthStore();
const authMode = ref(props.initialMode);

const currentComponent = computed(() => {
  return authMode.value === 'login' ? LoginForm : RegisterForm;
});

const handleClose = () => {
  emit('close');
  authStore.clearError();
};

const handleSuccess = () => {
  emit('success');
  handleClose();
};

const switchToLogin = () => {
  authMode.value = 'login';
  authStore.clearError();
};

const switchToRegister = () => {
  authMode.value = 'register';
  authStore.clearError();
};
</script>
//src\components\auth\LoginForm.vue
<template>
  <div class="login-form">
    <h2>–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</h2>
    <form @submit.prevent="handleSubmit">
      <BaseInput
          id="login"
          label="–õ–æ–≥–∏–Ω –∏–ª–∏ Email"
          v-model="form.login"
          required
          :error="errors.login"
      />

      <BaseInput
          id="password"
          label="–ü–∞—Ä–æ–ª—å"
          type="password"
          v-model="form.password"
          required
          :error="errors.password"
      />

      <div v-if="authStore.error" class="form-error">
        {{ authStore.error }}
      </div>

      <BaseButton
          type="submit"
          :disabled="authStore.isLoading"
          class="submit-button"
      >
        {{ authStore.isLoading ? '–í—Ö–æ–¥...' : '–í–æ–π—Ç–∏' }}
      </BaseButton>
    </form>

    <div class="form-footer">
      <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?</p>
      <BaseButton variant="outline" @click="$emit('switch-to-register')">
        –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
      </BaseButton>
    </div>
  </div>
</template>

<script setup>
import { reactive, computed } from 'vue';
import { useAuthStore } from '../../stores/auth.js';
import BaseInput from '../ui/BaseInput.vue';
import BaseButton from '../ui/BaseButton.vue';

const authStore = useAuthStore();

const emit = defineEmits(['success', 'switch-to-register']);

const form = reactive({
  login: '',
  password: ''
});

const errors = computed(() => {
  const errs = {};
  if (!form.login) errs.login = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
  if (!form.password) errs.password = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
  return errs;
});

const handleSubmit = async () => {
  if (Object.keys(errors.value).length > 0) return;

  authStore.clearError();
  const result = await authStore.login(form);

  if (result.success) {
    emit('success');
  }
};
</script>

<style scoped>
.login-form {
  text-align: center;
}

.submit-button {
  width: 100%;
  margin: 1rem 0;
}

.form-error {
  color: #dc3545;
  margin: 1rem 0;
}

.form-footer {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid #eee;
}
</style>
//src\components\auth\RegisterForm.vue
<template>
  <div class="register-form">
    <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <form @submit.prevent="handleSubmit">
      <BaseInput
          id="login"
          label="–õ–æ–≥–∏–Ω"
          v-model="form.login"
          required
          :error="errors.login"
      />

      <BaseInput
          id="displayName"
          label="–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è"
          v-model="form.displayName"
          required
          :error="errors.displayName"
      />

      <BaseInput
          id="email"
          label="Email"
          type="email"
          v-model="form.email"
          required
          :error="errors.email"
      />

      <BaseInput
          id="password"
          label="–ü–∞—Ä–æ–ª—å"
          type="password"
          v-model="form.password"
          required
          :error="errors.password"
      />

      <BaseInput
          id="confirmPassword"
          label="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è"
          type="password"
          v-model="form.confirmPassword"
          required
          :error="errors.confirmPassword"
      />

      <div v-if="authStore.error" class="form-error">
        {{ authStore.error }}
      </div>

      <BaseButton
          type="submit"
          :disabled="authStore.isLoading"
          class="submit-button"
      >
        {{ authStore.isLoading ? '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...' : '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è' }}
      </BaseButton>
    </form>

    <div class="form-footer">
      <p>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?</p>
      <BaseButton variant="outline" @click="$emit('switch-to-login')">
        –í–æ–π—Ç–∏
      </BaseButton>
    </div>
  </div>
</template>

<script setup>
import { reactive, computed } from 'vue';
import { useAuthStore } from '../../stores/auth.js';
import BaseInput from '../ui/BaseInput.vue';
import BaseButton from '../ui/BaseButton.vue';

const authStore = useAuthStore();

const emit = defineEmits(['success', 'switch-to-login']);

const form = reactive({
  login: '',
  displayName: '',
  email: '',
  password: '',
  confirmPassword: ''
});

const errors = computed(() => {
  const errs = {};
  if (!form.login) errs.login = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
  if (!form.displayName) errs.displayName = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
  if (!form.email) errs.email = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
  if (!form.password) errs.password = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
  if (!form.confirmPassword) errs.confirmPassword = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
  if (form.password && form.password.length < 6) errs.password = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤';
  if (form.password !== form.confirmPassword) errs.confirmPassword = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
  return errs;
});

const handleSubmit = async () => {
  if (Object.keys(errors.value).length > 0) return;

  authStore.clearError();
  const { confirmPassword, ...userData } = form;
  const result = await authStore.register(userData);

  if (result.success) {
    emit('success');
  }
};
</script>

<style scoped>
.register-form {
  text-align: center;
}

.submit-button {
  width: 100%;
  margin: 1rem 0;
}

.form-error {
  color: #dc3545;
  margin: 1rem 0;
}

.form-footer {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid #eee;
}
</style>
//src\components\layout\AppHeader.vue
<template>
  <header class="app-header">
    <div class="header-content">
      <div class="logo">
        <router-link to="/main" class="logo-link">
          <h1>El-store</h1>
        </router-link>
      </div>

      <nav class="navigation">
        <div v-if="authStore.isAdmin" class="nav-item">
          <BaseButton
              @click="goToAdmin"
              variant="outline"
              class="admin-button"
          >
            üõ†Ô∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
          </BaseButton>
        </div>

        <div class="nav-item" @click="handleCartClick">
          <BaseButton
              :disabled="!authStore.isAuthenticated"
              variant="outline"
              class="cart-button"
          >
            üõí –ö–æ—Ä–∑–∏–Ω–∞ <span v-if="cartStore.cartCount > 0" class="cart-badge">{{ cartStore.cartCount }}</span>
          </BaseButton>
        </div>

        <div class="nav-item" @click="goToOrders" v-if="authStore.isAuthenticated">
          <BaseButton variant="outline" class="orders-button">
            üìã –ó–∞–∫–∞–∑—ã
          </BaseButton>
        </div>

        <div class="nav-item" @click="handleAuthClick">
          <BaseButton variant="primary" class="auth-button">
            {{ authStore.isAuthenticated ? 'üë§ –ü—Ä–æ—Ñ–∏–ª—å' : '–í–æ–π—Ç–∏' }}
          </BaseButton>
        </div>
      </nav>
    </div>
  </header>
</template>

<script setup>
import { useRouter } from 'vue-router';
import { useAuthStore } from '../../stores/auth.js';
import { useCartStore } from '../../stores/cart.js';
import BaseButton from '../ui/BaseButton.vue';

const router = useRouter();
const authStore = useAuthStore();
const cartStore = useCartStore();

const goToAdmin = () => {
  router.push('/admin');
};

const handleCartClick = () => {
  if (authStore.isAuthenticated) {
    router.push('/cart');
  }
};

const handleAuthClick = () => {
  if (authStore.isAuthenticated) {
    router.push('/profile');
  } else {
    router.push('/auth');
  }
};

const goToOrders = () => {
  router.push('/orders');
};
</script>

<style scoped>
.app-header {
  background: #fff;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  padding: 1rem 0;
  position: sticky;
  top: 0;
  z-index: 100;
}

.header-content {
  max-width: 80%;
  margin: 0 auto;
  padding: 0 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo h1 {
  margin: 0;
  color: #007bff;
  font-size: 1.5rem;
}

.navigation {
  display: flex;
  gap: 1rem;
  align-items: center;
}

.nav-item {
  cursor: pointer;
}

.cart-button, .auth-button {
  min-width: 100px;
}

.logo-link {
  text-decoration: none;
  color: inherit;
}

.cart-badge {
  background: #dc3545;
  color: white;
  border-radius: 50%;
  padding: 0.1rem 0.4rem;
  font-size: 0.8rem;
  margin-left: 0.3rem;
}
</style>
//src\components\product\CategoryTreeNodeView.vue
<template>
  <div class="category-tree-node"
      :style="{ marginLeft: `${level * 20}px` }"
      @click="selectCategory">
    <span class="category-name"
      :data-selected="isSelected"
      @click="categorySelected">
      {{ category.name }}
    </span>

    <div v-if="category.children && category.children.length > 0" class="category-children">
      <CategoryTreeNodeView
          v-for="child in category.children"
          :key="child._id"
          :category="child"
          :level="level + 1"
          :allCategories="allCategories"
          :selected="false"
          @selected="(...args) => $emit('selected', ...args)"
      />
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue';

const props = defineProps({
  category: {
    type: Object,
    required: true
  },
  level: {
    type: Number,
    default: 0
  },
  allCategories: {
    type: Array,
    default: () => []
  },
  selected: {
    type: Boolean,
    default: () => false
  }
});

const emit = defineEmits(['selected']);

const isSelected = ref(false)

const categorySelected = () => {
  isSelected.value = !isSelected.value

  emit('selected', {
    categoryId: props.category._id,
    value: isSelected.value
  });
}
</script>

<style scoped>

.category-tree-node {
  margin: 0.5rem 0;
  padding: 0 1rem;
  user-select: none;
}

.category-name {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem;
  border-radius: 6px;
  border: 1px solid #dee2e6;
  flex: 1;
  gap: 1rem;
  font-weight: 600;
  transition: all 0.2s;
}

.category-name[data-selected="false"] {
  background: #f8f9fa;
}

.category-name[data-selected="true"] {
  background: #5da2e2;
  color: white;
}

.category-name[data-selected="false"]:hover{
  border-left: 5px solid blue;
  font-weight: bolder;
  cursor: pointer;
  background: #f0f1f2;
}

.category-name[data-selected="true"]:hover{
  border-left: 5px solid blue;
  font-weight: bolder;
  cursor: pointer;
  background: #abd5fd;
}

</style>
//src\components\ui\BaseButton.vue
<template>
  <button
      :class="['base-button', variant, size, { disabled }]"
      :disabled="disabled"
      @click="$emit('click')"
  >
    <slot></slot>
  </button>
</template>

<script setup>
defineProps({
  variant: {
    type: String,
    default: 'primary',
    validator: (value) => ['primary', 'secondary', 'outline'].includes(value)
  },
  size: {
    type: String,
    default: 'medium',
    validator: (value) => ['small', 'medium', 'large'].includes(value)
  },
  disabled: {
    type: Boolean,
    default: false
  }
});

defineEmits(['click']);
</script>

<style scoped>
.base-button {
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
  transition: all 0.2s;
}

.small {
  padding: 0.25rem 0.5rem;
  font-size: 0.875rem;
}

.medium {
  padding: 0.5rem 1rem;
  font-size: 1rem;
}

.large {
  padding: 0.75rem 1.5rem;
  font-size: 1.125rem;
}

.primary {
  background: #007bff;
  color: white;
}

.primary:hover:not(.disabled) {
  background: #0056b3;
}

.secondary {
  background: #6c757d;
  color: white;
}

.secondary:hover:not(.disabled) {
  background: #545b62;
}

.outline {
  background: transparent;
  border: 1px solid #007bff;
  color: #007bff;
}

.outline:hover:not(.disabled) {
  background: #007bff;
  color: white;
}

.disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
</style>
//src\components\ui\BaseInput.vue
<template>
  <div class="base-input">
    <label v-if="label" :for="id" class="input-label">{{ label }}</label>

    <input
        v-if="type !== 'textarea'"
        :id="id"
        :type="type"
        :value="modelValue"
        :placeholder="placeholder"
        :required="required"
        :disabled="disabled"
        @input="$emit('update:modelValue', $event.target.value)"
        class="input-field"
    />

    <textarea
        v-else
        :id="id"
        :value="modelValue"
        :placeholder="placeholder"
        :required="required"
        :disabled="disabled"
        @input="$emit('update:modelValue', $event.target.value)"
        class="textarea-field"
        :rows="rows"
    ></textarea>

    <div v-if="error" class="input-error">{{ error }}</div>
  </div>
</template>

<script setup>
defineProps({
  id: String,
  label: String,
  type: {
    type: String,
    default: 'text'
  },
  modelValue: [String, Number],
  placeholder: String,
  required: Boolean,
  error: String,
  disabled: Boolean,
  rows: {
    type: Number,
    default: 3
  }
});

defineEmits(['update:modelValue']);
</script>

<style scoped>
.base-input {
  margin-bottom: 1rem;
}

.input-label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
}

.input-field, .textarea-field {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 1rem;
  font-family: inherit;
}

.input-field:focus, .textarea-field:focus {
  outline: none;
  border-color: #007bff;
  box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
}

.input-field:disabled, .textarea-field:disabled {
  background: #f8f9fa;
  cursor: not-allowed;
  opacity: 0.7;
}

.textarea-field {
  resize: vertical;
  min-height: 80px;
}

.input-error {
  color: #dc3545;
  font-size: 0.875rem;
  margin-top: 0.25rem;
}
</style>
//src\components\ui\BaseModal.vue
<template>
  <div v-if="isOpen" class="modal-overlay" @click="handleOverlayClick">
    <div class="modal-content" @click.stop>
      <button class="modal-close" @click="$emit('close')">√ó</button>
      <slot></slot>
    </div>
  </div>
</template>

<script setup>
defineProps({
  isOpen: {
    type: Boolean,
    required: true
  }
});

const emit = defineEmits(['close']);

const handleOverlayClick = () => {
  emit('close');
};
</script>

<style scoped>
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-content {
  background: white;
  padding: 2rem;
  border-radius: 8px;
  position: relative;
  min-width: 400px;
  max-width: 90vw;
}

.modal-close {
  position: absolute;
  top: 10px;
  right: 10px;
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0;
  width: 30px;
  height: 30px;
}
</style>
//src\main.js
import { createApp } from 'vue';
import { createPinia } from 'pinia';
import router from './router';
import App from './App.vue';

const app = createApp(App);
const pinia = createPinia();

app.use(pinia);
app.use(router);

app.mount('#app');

//src\pages\admin\AdminPage.vue
<!-- src/pages/admin/AdminPage.vue -->
<template>
  <div class="admin-page">
    <AppHeader />
    <div class="admin-layout">
      <aside class="sidebar">
        <nav class="sidebar-nav">
          <router-link
              to="/admin/products"
              class="nav-link"
              :class="{ active: $route.path.includes('/products') }"
          >
            üì¶ –¢–æ–≤–∞—Ä—ã
          </router-link>
          <router-link
              to="/admin/categories"
              class="nav-link"
              :class="{ active: $route.path.includes('/categories') }"
          >
            üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
          </router-link>
          <router-link
              to="/admin/users"
              class="nav-link"
              :class="{ active: $route.path.includes('/users') }"
          >
            üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
          </router-link>
          <router-link
              to="/admin/orders"
              class="nav-link"
              :class="{ active: $route.path.includes('/orders') }"
          >
            üìã –ó–∞–∫–∞–∑—ã
          </router-link>
        </nav>
      </aside>

      <main class="admin-content">
        <router-view></router-view>
      </main>
    </div>
  </div>
</template>

<script setup>
import AppHeader from '../../components/layout/AppHeader.vue';
</script>

<style scoped>
.admin-page {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.admin-layout {
  display: flex;
  flex: 1;
}

.sidebar {
  width: 250px;
  background: #f8f9fa;
  border-right: 1px solid #dee2e6;
  padding: 1rem 0;
}

.sidebar-nav {
  display: flex;
  flex-direction: column;
}

.nav-link {
  padding: 0.75rem 1.5rem;
  text-decoration: none;
  color: #333;
  transition: all 0.2s;
  border-left: 3px solid transparent;
}

.nav-link:hover {
  background: #e9ecef;
  color: #007bff;
}

.nav-link.active {
  background: #007bff;
  color: white;
  border-left-color: #0056b3;
}

.admin-content {
  flex: 1;
  padding: 0;
  background: #fff;
}
</style>
//src\pages\admin\CategoriesSubPage.vue
<template>
  <div class="categories-page">
    <div class="page-header">
      <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h2>
      <p>–°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–æ–≤–∞—Ä–æ–≤</p>
    </div>

    <div class="categories-layout">
      <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
      <div class="form-section">
        <div class="section-card">
          <h3>–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
          <form @submit.prevent="handleCreateCategory" class="category-form">
            <BaseInput
                id="categoryName"
                label="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ *"
                v-model="createForm.name"
                placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
                required
                :error="createFormErrors.name"
            />

            <div class="form-group">
              <label for="parentCategory">–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
              <select
                  id="parentCategory"
                  v-model="createForm.parentCategory"
                  class="form-select"
              >
                <option :value="null">–ö–æ—Ä–Ω–µ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è (–±–µ–∑ —Ä–æ–¥–∏—Ç–µ–ª—è)</option>
                <option
                    v-for="category in flatCategories"
                    :key="category._id"
                    :value="category._id"
                >
                  {{ category.nameWithPath }}
                </option>
              </select>
              <div class="form-help">
                –ï—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ, –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ
              </div>
            </div>

            <div v-if="adminCategoriesStore.error" class="form-error">
              {{ adminCategoriesStore.error }}
            </div>

            <BaseButton
                type="submit"
                :disabled="adminCategoriesStore.isLoading || !createForm.name.trim()"
                class="submit-button"
            >
              {{ adminCategoriesStore.isLoading ? '–°–æ–∑–¥–∞–Ω–∏–µ...' : '–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é' }}
            </BaseButton>
          </form>
        </div>
      </div>

      <!-- –î–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
      <div class="tree-section">
        <div class="section-card">
          <div class="section-header">
            <h3>–î–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h3>
            <BaseButton
                @click="loadCategories"
                variant="outline"
                size="small"
                :disabled="adminCategoriesStore.isLoading"
            >
              üîÑ –û–±–Ω–æ–≤–∏—Ç—å
            </BaseButton>
          </div>

          <div v-if="adminCategoriesStore.isLoading && adminCategoriesStore.categories.length === 0" class="loading">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...</p>
          </div>

          <div v-else-if="adminCategoriesStore.error" class="error">
            <p>‚ùå {{ adminCategoriesStore.error }}</p>
            <BaseButton @click="loadCategories" variant="outline">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É</BaseButton>
          </div>

          <div v-else-if="adminCategoriesStore.categories.length === 0" class="empty">
            <p>üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
            <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å –ø–æ–º–æ—â—å—é —Ñ–æ—Ä–º—ã —Å–ª–µ–≤–∞</p>
          </div>

          <div v-else class="category-tree">
            <CategoryTreeNode
                v-for="category in adminCategoriesStore.categories"
                :key="category._id"
                :category="category"
                :level="0"
                :allCategories="flatCategories"
                @category-updated="handleCategoryUpdate"
                @category-deleted="handleCategoryDelete"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ -->
    <div v-if="successMessage" class="success-notification">
      {{ successMessage }}
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted } from 'vue';
import { useAdminCategoriesStore } from '../../stores/adminCategories.js';
import BaseInput from '../../components/ui/BaseInput.vue';
import BaseButton from '../../components/ui/BaseButton.vue';
import CategoryTreeNode from '../../components/admin/CategoryTreeNode.vue';

const adminCategoriesStore = useAdminCategoriesStore();

const createForm = reactive({
  name: '',
  parentCategory: null
});

const createFormErrors = ref({});
const successMessage = ref('');

// –°–æ–∑–¥–∞–µ–º –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –ø—É—Ç—è–º–∏ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
const flatCategories = computed(() => {
  const flatten = (categories, path = '') => {
    let result = [];
    categories.forEach(cat => {
      const currentPath = path ? `${path} ‚Üí ${cat.name}` : cat.name;
      result.push({
        ...cat,
        nameWithPath: currentPath
      });
      if (cat.children && cat.children.length > 0) {
        result = result.concat(flatten(cat.children, currentPath));
      }
    });
    return result;
  };
  return flatten(adminCategoriesStore.categories);
});

const validateCreateForm = () => {
  const errors = {};
  if (!createForm.name.trim()) {
    errors.name = '–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ';
  }
  createFormErrors.value = errors;
  return Object.keys(errors).length === 0;
};

const resetCreateForm = () => {
  createForm.name = '';
  createForm.parentCategory = null;
  createFormErrors.value = {};
};

const showSuccess = (message) => {
  successMessage.value = message;
  setTimeout(() => {
    successMessage.value = '';
  }, 3000);
};

const loadCategories = () => {
  adminCategoriesStore.loadCategories();
};

const handleCreateCategory = async () => {
  if (!validateCreateForm()) return;

  const categoryData = {
    name: createForm.name.trim(),
    parentCategory: createForm.parentCategory
  };

  const result = await adminCategoriesStore.createCategory(categoryData);

  if (result.success) {
    showSuccess('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!');
    resetCreateForm();
  }
};

const handleCategoryUpdate = async ({ categoryId, data }) => {
  const result = await adminCategoriesStore.updateCategory(categoryId, data);

  if (result.success) {
    showSuccess('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
  }
};

const handleCategoryDelete = async (categoryId) => {
  const result = await adminCategoriesStore.deleteCategory(categoryId);

  if (result.success) {
    showSuccess('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!');
  }
};

onMounted(() => {
  loadCategories();
});
</script>

<style scoped>
.categories-page {
  padding: 2rem;
  max-width: 1400px;
  margin: 0 auto;
}

.page-header {
  margin-bottom: 2rem;
  text-align: center;
}

.page-header h2 {
  color: #333;
  margin-bottom: 0.5rem;
}

.page-header p {
  color: #6c757d;
}

.categories-layout {
  display: grid;
  grid-template-columns: 400px 1fr;
  gap: 2rem;
  align-items: start;
}

.section-card {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  border: 1px solid #e9ecef;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.section-header h3 {
  margin: 0;
  color: #333;
}

.category-form {
  margin-top: 1rem;
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: #333;
}

.form-select {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 1rem;
  background: white;
  transition: border-color 0.2s;
}

.form-select:focus {
  outline: none;
  border-color: #007bff;
}

.form-help {
  font-size: 0.875rem;
  color: #6c757d;
  margin-top: 0.25rem;
}

.submit-button {
  width: 100%;
  padding: 0.75rem;
  font-size: 1rem;
}

.loading, .error, .empty {
  text-align: center;
  padding: 3rem 2rem;
  background: #f8f9fa;
  border-radius: 8px;
  margin: 1rem 0;
}

.error {
  color: #dc3545;
  background: #f8d7da;
}

.empty {
  color: #6c757d;
}

.spinner {
  border: 3px solid #f3f3f3;
  border-top: 3px solid #007bff;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 0 auto 1rem;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.category-tree {
  max-height: 600px;
  overflow-y: auto;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 6px;
}

.success-notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #28a745;
  color: white;
  padding: 1rem 1.5rem;
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  z-index: 1000;
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1024px) {
  .categories-layout {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  .categories-page {
    padding: 1rem;
  }
}
</style>
//src\pages\admin\OrdersSubPage.vue
<template>

</template>

<script setup>

</script>

<style scoped>

</style>
//src\pages\admin\ProductsSubPage.vue
<template>

</template>

<script setup>

</script>

<style scoped>

</style>
//src\pages\admin\UsersSubPage.vue
<!-- src/pages/admin/UsersSubPage.vue -->
<template>
  <div class="users-page">
    <div class="page-header">
      <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
      <p>–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {{ adminUsersStore.pagination.total }}</p>
    </div>

    <div class="controls">
      <div class="search-box">
        <BaseInput
            v-model="search"
            placeholder="–ü–æ–∏—Å–∫ –ø–æ –ª–æ–≥–∏–Ω—É, –∏–º–µ–Ω–∏ –∏–ª–∏ email..."
            @update:modelValue="handleSearch"
        />
      </div>
    </div>

    <div v-if="adminUsersStore.isLoading" class="loading">
      –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...
    </div>

    <div v-else-if="adminUsersStore.error" class="error">
      {{ adminUsersStore.error }}
      <BaseButton @click="loadUsers" variant="outline">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</BaseButton>
    </div>

    <div v-else-if="adminUsersStore.users.length === 0" class="empty">
      –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
    </div>

    <div v-else class="users-table">
      <table class="table">
        <thead>
        <tr>
          <th>–õ–æ–≥–∏–Ω</th>
          <th>–ò–º—è</th>
          <th>Email</th>
          <th>–†–æ–ª—å</th>
          <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        <tr v-for="user in adminUsersStore.users" :key="user._id" class="user-row">
          <td>{{ user.login }}</td>
          <td>{{ user.displayName }}</td>
          <td>{{ user.email }}</td>
          <td>
              <span :class="['role-badge', user.role === '–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†' ? 'admin' : 'user']">
                {{ user.role }}
              </span>
          </td>
          <td>{{ formatDate(user.createdAt) }}</td>
          <td class="actions">
            <BaseButton
                v-if="user.role === '–ü–û–ö–£–ü–ê–¢–ï–õ–¨'"
                @click="makeAdmin(user._id)"
                variant="outline"
                size="small"
                :disabled="updatingUser === user._id"
            >
              {{ updatingUser === user._id ? '...' : '–°–¥–µ–ª–∞—Ç—å –∞–¥–º–∏–Ω–æ–º' }}
            </BaseButton>
            <BaseButton
                v-else
                @click="removeAdmin(user._id)"
                variant="outline"
                size="small"
                :disabled="updatingUser === user._id || userInfo.id === user._id"
            >
              {{ updatingUser === user._id ? '...' : '–£–±—Ä–∞—Ç—å –∞–¥–º–∏–Ω–∞' }}
            </BaseButton>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <div v-if="adminUsersStore.pagination.totalPages > 1" class="pagination">
      <BaseButton
          @click="changePage(Number.parseInt(adminUsersStore.pagination.currentPage) - 1)"
          :disabled="Number.parseInt(adminUsersStore.pagination.currentPage) === 1"
          variant="outline"
      >
        –ù–∞–∑–∞–¥
      </BaseButton>

      <span class="page-info">
        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ adminUsersStore.pagination.currentPage }} –∏–∑ {{ adminUsersStore.pagination.totalPages }}
      </span>

      <BaseButton
          @click="changePage(Number.parseInt(adminUsersStore.pagination.currentPage) + 1)"
          :disabled="Number.parseInt(adminUsersStore.pagination.currentPage) === adminUsersStore.pagination.totalPages"
          variant="outline"
      >
        –í–ø–µ—Ä–µ–¥
      </BaseButton>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { useAdminUsersStore } from '../../stores/adminUsers.js';
import { useAuthStore } from "../../stores/auth.js";
import BaseInput from '../../components/ui/BaseInput.vue';
import BaseButton from '../../components/ui/BaseButton.vue';
import {storeToRefs} from "pinia";

const adminUsersStore = useAdminUsersStore();
const { userInfo } = storeToRefs(useAuthStore());
const search = ref('');
const updatingUser = ref(null);
let searchTimeout = null;

const loadUsers = (page = 1) => {
  adminUsersStore.loadUsers(page, 10, search.value);
};

const handleSearch = () => {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => {
    loadUsers(1);
  }, 500);
};

const changePage = (page) => {
  if (page >= 1 && page <= adminUsersStore.pagination.totalPages) {
    loadUsers(page);
  }
};

const makeAdmin = async (userId) => {
  updatingUser.value = userId;
  const result = await adminUsersStore.updateRole(userId, '–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†');
  updatingUser.value = null;

  if (!result.success) {
    alert(result.error);
  }
};

const removeAdmin = async (userId) => {
  updatingUser.value = userId;
  const result = await adminUsersStore.updateRole(userId, '–ü–û–ö–£–ü–ê–¢–ï–õ–¨');
  updatingUser.value = null;

  if (!result.success) {
    alert(result.error);
  }
};

const formatDate = (dateString) => {
  return dateString ? new Date(dateString).toLocaleDateString('ru-RU') : '-';
};

onMounted(() => {
  loadUsers();
});
</script>

<style scoped>
.users-page {
  padding: 2rem;
  max-width: 1200px;
  margin: 0 auto;
}

.page-header {
  margin-bottom: 2rem;
}

.controls {
  margin-bottom: 1.5rem;
}

.search-box {
  max-width: 400px;
}

.loading, .error, .empty {
  text-align: center;
  padding: 3rem;
  background: #f8f9fa;
  border-radius: 8px;
  margin: 1rem 0;
}

.error {
  color: #dc3545;
}

.users-table {
  background: white;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.table {
  width: 100%;
  border-collapse: collapse;
}

.table th,
.table td {
  padding: 1rem;
  text-align: left;
  border-bottom: 1px solid #dee2e6;
}

.table th {
  background: #f8f9fa;
  font-weight: 600;
}

.user-row:hover {
  background: #f8f9fa;
}

.role-badge {
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.875rem;
  font-weight: 500;
}

.role-badge.admin {
  background: #007bff;
  color: white;
}

.role-badge.user {
  background: #6c757d;
  color: white;
}

.actions {
  white-space: nowrap;
}

.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  margin-top: 2rem;
  padding: 1rem;
}

.page-info {
  font-weight: 500;
}
</style>
//src\pages\AuthPage.vue
<template>
  <div class="auth-page">
    <AuthModal
        :isOpen="true"
        :initialMode="initialMode"
        @close="handleModalClose"
        @success="handleAuthSuccess"
    />
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { useRouter } from 'vue-router';
import { useAuthStore } from '../stores/auth.js';
import AuthModal from '../components/auth/AuthModal.vue';

const router = useRouter();
const authStore = useAuthStore();

const initialMode = ref('login');

onMounted(() => {
  if (authStore.isAuthenticated) {
    router.push('/');
    return;
  }

  const urlParams = new URLSearchParams(window.location.search);
  const mode = urlParams.get('mode');
  if (mode === 'register') {
    initialMode.value = 'register';
  }
});

const handleModalClose = () => {
  if (window.history.length > 1) {
    router.back();
  } else {
    router.push('/');
  }
};

const handleAuthSuccess = () => {
  router.push('/main');
};
</script>

<style scoped>
.auth-page {
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
}
</style>
//src\pages\shared\MainSubPage.vue
<template>
  <div class="home-page">
    <main class="main-content">
      <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
        <div class="welcome-message">
          <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ El-store!</h2>
          <p>–õ—É—á—à–∏–π –º–∞–≥–∞–∑–∏–Ω —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏ —Å –≤—ã–≥–æ–¥–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏</p>
        </div>
        <div class="welcome-user">
          <p>–ü—Ä–∏–≤–µ—Ç, <b>{{ username }}</b>!</p>
          <p>–ù–∞—á–Ω–∏—Ç–µ –ø–æ–∫—É–ø–∫–∏ –≤ –Ω–∞—à–µ–º –∫–∞—Ç–∞–ª–æ–≥–µ</p>
        </div>
      </div>

      <div class="header-fields-section">
        <button class="show-categories-btn" @click="showCategories = !showCategories">
          <span>{{ showCategories ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å' }} –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
        </button>
        <div class="search-container">
          <input 
            type="text" 
            name="name"
            v-model="searchQuery" 
            placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." 
            class="search-input"
          >
          <button class="search-btn" @click="handleSearch">–ù–∞–π—Ç–∏</button>
        </div>
      </div>
      <div class="products-content">
        <div class="categories-sidebar" v-if="showCategories">
          <div v-if="adminCategoriesStore.isLoading && adminCategoriesStore.categories.length === 0" class="loading">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...</p>
          </div>

          <div v-else-if="adminCategoriesStore.error" class="error">
            <p>‚ùå {{ adminCategoriesStore.error }}</p>
            <BaseButton @click="adminCategoriesStore.loadCategories" variant="outline">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É</BaseButton>
          </div>

          <div v-else-if="adminCategoriesStore.categories.length === 0" class="empty">
            <p>üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
          </div>

          <div v-else>
            <CategoryTreeNodeView
                v-for="category in adminCategoriesStore.categories"
                  :key="category._id"
                  :category="category"
                  :level="0"
                  :allCategories="flatCategories"
                  :selected=false
                  @selected="handleSelected"
            />
          </div>
        </div>

        <div class="products-grid">
          <div 
            class="product-card" 
            v-for="product in filteredProducts" 
            :key="product._id"
          >
            <div @click="redirectToProduct(product._id)">
              <div class="product-image">
                <img 
                  :src="getProductImage(product)" 
                  :alt="product.name"
                >
              </div>
              <div class="product-info">
                <h3 class="product-name">{{ product.name }}</h3>
                <div class="product-price">{{ product.price }} {{ currency }}</div>
                <div>–í –Ω–∞–ª–∏—á–∏–∏: {{product.stock}} —à—Ç.</div>
              </div>
            </div>
            <button 
              class="add-to-cart-btn" 
              @click="addToCart(product)"
              :disabled="product.stock === 0"
            >
              {{ product.stock > 0 ? '–í –∫–æ—Ä–∑–∏–Ω—É' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏' }}
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue';
import { useRouter } from 'vue-router'
import { useAuthStore } from '../../stores/auth.js';
import { useProductStore } from '../../stores/product.js';
import { useAdminCategoriesStore } from '../../stores/adminCategories.js';
import { useCartStore } from '../../stores/cart.js';
import CategoryTreeNodeView from '../../components/product/CategoryTreeNodeView.vue';
import BaseButton from '../../components/ui/BaseButton.vue';

const currency = '‚ÇΩ';
const imagePlaceholderUrl = '/src/uploads/product_placeholder.png'

const adminCategoriesStore = useAdminCategoriesStore();
const authStore = useAuthStore();
const productStore = useProductStore();
const cartStore = useCartStore();
const router = useRouter()

const showCategories = ref(false)
const selectedCategories = ref(new Set)
const searchQuery = ref('')

const username = computed(() => {
  return authStore.isAuthenticated ? authStore.userInfo?.displayName : '–ì–æ—Å—Ç—å';
})

const filteredProducts = computed(() => productStore.products)

const handleSelected = (data) => {
  if (data.value) {
    selectedCategories.value.add(data.categoryId)
  }
  else {
    selectedCategories.value.delete(data.categoryId)
  }
  handleSearch()
}

const handleSearch = async () => {
  const result = await productStore.findProducts(searchQuery.value, Array.from(selectedCategories.value));
  productStore.products = result.value
}

const redirectToProduct = (productId) => {
  router.push(`/product/${productId}`)
}

const addToCart = async (product) => {
  if (!authStore.isAuthenticated) {
    alert("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è!");
    router.push('/auth');
    return;
  }

  try {
    const result = await cartStore.addToCart(product._id, 1);
    if (result.success) {
      alert(`–¢–æ–≤–∞—Ä "${product.name}" –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!`);
    } else {
      alert(result.error || '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É');
    }
  } catch (error) {
    alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É');
  }
};

const flatCategories = computed(() => {
  const flatten = (categories, path = '') => {
    let result = [];
    categories.forEach(cat => {
      const currentPath = path ? `${path} ‚Üí ${cat.name}` : cat.name;
      result.push({
        ...cat,
        nameWithPath: currentPath
      });
      if (cat.children && cat.children.length > 0) {
        result = result.concat(flatten(cat.children, currentPath));
      }
    });
    return result;
  };
  return flatten(adminCategoriesStore.categories);
});

const getProductImage = (product) => {
  return product.images && product.images.length > 0 ? product.images[0] : imagePlaceholderUrl
}

onMounted(() => {
  adminCategoriesStore.loadCategories()
  productStore.getAllProducts()
});
</script>

<style scoped>
.home-page {
  margin: 0 10%;
  padding: 2rem;
}

.main-content {
  text-align: center;
  padding: 2rem 0;
}

.welcome-message {
  text-align: left;
  margin-top: 1rem;
  margin-right: 2rem;
}

.welcome-user {
  padding: 2rem;
  margin-left: 2rem;
  text-align: right;
  background: #f8f9fa;
  border-radius: 8px;
}

.products-content
{
  display: flex;
}

.product-section {
  margin: 1rem 0;
  width: 100%;
}

.product-section .product-card {
  display: flex;
  border: 2px dotted grey;
  border-radius: 10px;
  padding: 20px;
  margin: 20px 0;
}

.product-section .product-card img {
  max-width: 200px;
}

.categories-layout {
  display: grid;
  grid-template-columns: 400px 1fr;
  gap: 2rem;
  align-items: start;
  overflow: hidden;
}

.section-card {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  border: 1px solid #e9ecef;
}

.submit-button {
  width: 100%;
  padding: 0.75rem;
  font-size: 1rem;
}

.loading, .error, .empty {
  text-align: center;
  padding: 3rem 2rem;
  background: #f8f9fa;
  border-radius: 8px;
  margin: 1rem 0;
}

.error {
  color: #dc3545;
  background: #f8d7da;
}

.empty {
  color: #6c757d;
}

.spinner {
  border: 3px solid #f3f3f3;
  border-top: 3px solid #007bff;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 0 auto 1rem;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@media (max-width: 1024px) {
  .categories-layout {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  .categories-page {
    padding: 1rem;
  }
}

.header-fields-section {
  display: flex;
  margin-bottom: 30px;
}

.search-container {
  display: flex;
  width: 100%;
  flex: 1;
}

.search-input {
  flex: 1;
  padding: 12px;
  border: 1px solid #ddd;
  border-radius: 6px 0 0 6px;
  font-size: 16px;
}

.search-btn {
  background: #28a745;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 0 6px 6px 0;
  cursor: pointer;
  font-size: 16px;
}

.search-btn:hover {
  background: #218838;
}

.products-grid {
  width: 100%;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;
  margin-bottom: 20px;
}

.product-card {
  border: 1px solid #ddd;
  border-radius: 8px;
  overflow: hidden;
  background: white;
  transition: transform 0.3s, box-shadow 0.3s;
}

.product-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.product-image {
  width: 100%;
  height: 200px;
  overflow: hidden;
  padding: 20px;
}

.product-image img {
  width: 100%;
  height: 100%;
  object-fit: scale-down;
}

.product-info {
  padding: 16px;
  user-select: none;
}

.product-name {
  margin: 0 0 8px 0;
  font-size: 18px;
}

.product-info .product-description {
  margin-bottom: 12px;
  line-height: 1.4;
}

.product-info .product-price {
  font-size: 20px;
  font-weight: bold;
  color: #007bff;
  margin-bottom: 12px;
}

.add-to-cart-btn {
  width: 100%;
  background: #28a745;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  transition: background-color 0.3s;
}

.add-to-cart-btn:hover:not(:disabled) {
  background: #218838;
}

.add-to-cart-btn:disabled {
  background: #6c757d;
  cursor: not-allowed;
}

.catalog-section {
  display: block;
  position: relative;
  margin-bottom: 20px;
}

.show-categories-btn {
  position: relative;
  display: block;
  left: 0;
  background: #007bff;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
  width: 250px;
  height: 100%;
  margin-right: 1rem;
}

.show-categories-btn:hover {
  background: #0056b3;
}

.categories-sidebar {
  position: relative;
  background: white;
  border: 1px solid #ddd;
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  min-width: 250px;
  height: 60vh;
  overflow-y: scroll;
  margin-right: 1rem;
}
</style>
//src\pages\shared\ProductSubPage.vue
<template>
  <div class="product-page">
    <nav class="breadcrumbs">
      <router-link to="/main" class="breadcrumb-link">–ì–ª–∞–≤–Ω–∞—è</router-link>
      <span class="breadcrumb-separator">/</span>
      <span class="breadcrumb-current" v-if="!productStore.isLoading && product">–¢–æ–≤–∞—Ä {{product.name}}</span>
      <span class="breadcrumb-current" v-else>–¢–æ–≤–∞—Ä</span>
    </nav>

    <div class="product-container" v-if="product">
      <div class="product-gallery">
        <div class="main-image">
          <img 
            :src="getProductImage(product)" 
            :alt="product.name"
            @error="handleImageError"
          >
        </div>
        
        <div class="thumbnails" v-if="product.images && product.images.length > 1">
          <div 
            v-for="(image, index) in product.images" 
            :key="index"
            class="thumbnail-item"
            :class="{ active: currentImageIndex === index }"
            @click="changeImage(index)"
          >
            <img 
              :src="image" 
              :alt="`${product.name} - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${index + 1}`"
              @error="handleThumbnailError"
            >
          </div>
        </div>
      </div>

      <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ -->
      <div class="product-info">
        <h1 class="product-title">{{ product.name }}</h1>
        
        <div class="product-meta">
          <div class="product-sku">–ê—Ä—Ç–∏–∫—É–ª: {{ product._id }}</div>
        </div>

        <div class="product-price-section">
          <div class="current-price">{{ product.price }} {{currency}}</div>
        </div>

        <div class="product-stock">
          <span :class="stockStatusClass">
            {{ stockStatusText }}
          </span>
        </div>

        <div class="product-description">
          <h3>–û–ø–∏—Å–∞–Ω–∏–µ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
          <p>{{ product.description }}</p>
        </div>

        <div class="product-actions">
          <div class="quantity-selector">
            <button 
              class="qty-btn minus" 
              @click="decreaseQuantity"
              :disabled="quantity <= 1"
            >-</button>
            <input 
              type="number" 
              v-model.number="quantity" 
              min="1" 
              :max="product.stock"
              class="qty-input"
            >
            <button 
              class="qty-btn plus" 
              @click="increaseQuantity"
              :disabled="quantity >= product.stock"
            >+</button>
          </div>

          <button 
            class="add-to-cart-btn primary"
            @click="addToCart"
            :disabled="product.stock === 0"
          >
            <span v-if="product.stock > 0">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</span>
            <span v-else>–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
          </button>
        </div>
      </div>
    </div>

    <div class="loading-state" v-else-if="productStore.isLoading">
      <div class="spinner"></div> 
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–≤–∞—Ä–µ...</p>
    </div>
    <div class="error-state" v-else-if="productStore.error">
      <h2>–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω</h2>
      <p>–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–π —Ç–æ–≤–∞—Ä –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –±—ã–ª —É–¥–∞–ª–µ–Ω.</p>
      <router-link to="/main" class="back-to-home">
        –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
      </router-link>
    </div>
    <div class="related-products" v-if="relatedProducts.length > 0 && product">
      <h2>–ü–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã</h2>
      <div class="related-grid">
        <div 
          v-for="relatedProduct in relatedProducts" 
          :key="relatedProduct._id"
          class="related-card"
          @click="redirectToProduct(relatedProduct._id)"
        >
          <div class="related-image">
            <img 
              :src="getProductImage(relatedProduct)" 
              :alt="relatedProduct.name"
            >
          </div>
          <div class="related-info">
            <h4>{{ relatedProduct.name }}</h4>
            <p class="related-price">{{ relatedProduct.price }} {{currency}}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted, watch } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { useProductStore } from '../../stores/product.js'
import { useAuthStore } from '../../stores/auth.js'
import { useCartStore } from '../../stores/cart.js'

const currency = '‚ÇΩ'
const imagePlaceholder = '/src/uploads/product_placeholder.png'

const route = useRoute()
const router = useRouter()
const productStore = useProductStore()
const authStore = useAuthStore()
const cartStore = useCartStore()

const product = ref(null)
const currentImageIndex = ref(0)
const quantity = ref(1)
const relatedProducts = ref([])

const stockStatusText = computed(() => {
  if (!product.value) return ''
  
  if (product.value.stock > 10) {
    return `–í –Ω–∞–ª–∏—á–∏–∏ (${product.value.stock} —à—Ç.)`
  } else if (product.value.stock > 0) {
    return `–ú–∞–ª–æ –≤ –Ω–∞–ª–∏—á–∏–∏ (${product.value.stock} —à—Ç.)`
  } else {
    return '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'
  }
})

const stockStatusClass = computed(() => {
  if (!product.value) return ''
  
  if (product.value.stock > 10) {
    return 'stock-available'
  } else if (product.value.stock > 0) {
    return 'stock-low'
  } else {
    return 'stock-out'
  }
})

const changeImage = (index) => {
  currentImageIndex.value = index
}

const increaseQuantity = () => {
  if (quantity.value < product.value.stock) {
    quantity.value++
  }
}

const decreaseQuantity = () => {
  if (quantity.value > 1) {
    quantity.value--
  }
}

const addToCart = async () => {
  if (!authStore.isAuthenticated) {
    alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è!');
    router.push('/auth');
    return;
  }

  if (product.value && product.value.stock > 0) {
    try {
      const result = await cartStore.addToCart(product.value._id, quantity.value);
      if (result.success) {
        alert(`–¢–æ–≤–∞—Ä "${product.value.name}" (${quantity.value} —à—Ç.) –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!`);
      } else {
        alert(result.error || '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É');
      }
    } catch (error) {
      alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É');
    }
  }
};

const getProductImage = (product) => {
  return product.images && product.images.length > 0 ? product.images[0] : imagePlaceholder
}

const redirectToProduct = (productId) => {
  router.push(`/product/${productId}`)
}

const fetchProduct = async (productId) => {
  const fetchedProduct = await productStore.getOneProduct(productId)
  
  if (fetchedProduct) {
    product.value = fetchedProduct.value
    await loadRelatedProducts()
  }
}

const loadRelatedProducts = async () => {
  if (!product.value) return
  
  if (product.value.categories && product.value.categories.length > 0) {
    const sameCategoryProducts = await productStore.getProductsFromCategories(product.value.categories)
    // FIXME –≤–æ–∑–º–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –æ—Ç –Ω–∞–ª–∏—á–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Ç–æ–≤–∞—Ä–∞ —Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ API
    const similarProducts = sameCategoryProducts.value.filter(obj => obj._id !== product.value._id)
    
    // FIXME —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è –≤—ã–≤–æ–¥–∞ –ø–æ—Ö–æ–∂–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤, –Ω–µ –≤ –∫—É—Ä—Å–µ, –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å –ª—É—á—à–µ
	  for (let i = 0; i < similarProducts.length; i++) {
      const j = Math.floor(Math.random() * similarProducts.length);
      [similarProducts[i], similarProducts[j]] = [similarProducts[j], similarProducts[i]];
    }
    relatedProducts.value = similarProducts.slice(0, 4)
  }
}

watch(() => route.params.productId, (newId) => {
  if (newId) {
    fetchProduct(newId)
    currentImageIndex.value = 0
    quantity.value = 1
  }
})

onMounted(() => {
  fetchProduct(route.params.productId)
})
</script>

<style scoped>
.product-page {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

/* –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ */
.breadcrumbs {
  margin-bottom: 20px;
  font-size: 14px;
  color: #666;
}

.breadcrumb-link {
  color: #007bff;
  text-decoration: none;
}

.breadcrumb-link:hover {
  text-decoration: underline;
}

.breadcrumb-separator {
  margin: 0 8px;
}

.breadcrumb-current {
  color: #333;
}

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–æ–≤–∞—Ä–∞ */
.product-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 40px;
  margin-bottom: 60px;
}

@media (max-width: 768px) {
  .product-container {
    grid-template-columns: 1fr;
    gap: 20px;
  }
}

/* –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
.product-gallery {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.main-image {
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  overflow: hidden;
  background: #f8f9fa;
}

.product-main-img {
  width: 100%;
  height: 400px;
  object-fit: contain;
  display: block;
}

.thumbnails {
  display: flex;
  gap: 10px;
  overflow-x: auto;
  padding-bottom: 10px;
}

.thumbnail-item {
  min-width: 80px;
  height: 80px;
  border: 2px solid transparent;
  border-radius: 4px;
  overflow: hidden;
  cursor: pointer;
  transition: border-color 0.3s;
}

.thumbnail-item.active {
  border-color: #007bff;
}

.thumbnail-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.thumbnail-item:hover {
  border-color: #007bff;
}

/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ */
.product-info {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.product-title {
  font-size: 28px;
  font-weight: bold;
  color: #333;
  margin: 0;
}

.product-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: #666;
}

.product-price-section {
  display: flex;
  align-items: center;
  gap: 15px;
}

.current-price {
  font-size: 32px;
  font-weight: bold;
  color: #007bff;
}

.product-stock {
  font-size: 16px;
  font-weight: 500;
}

.stock-available {
  color: #28a745;
}

.stock-low {
  color: #ffc107;
}

.stock-out {
  color: #dc3545;
}

.product-description h3 {
  font-size: 20px;
  margin-bottom: 10px;
  color: #333;
}

.product-description p {
  line-height: 1.6;
  color: #666;
}

/* –î–µ–π—Å—Ç–≤–∏—è —Å —Ç–æ–≤–∞—Ä–æ–º */
.product-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  align-items: center;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 8px;
}

.quantity-selector {
  display: flex;
  align-items: center;
  border: 1px solid #ddd;
  border-radius: 6px;
  overflow: hidden;
}

.qty-btn {
  width: 40px;
  height: 40px;
  background: white;
  border: none;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.qty-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.qty-btn:hover:not(:disabled) {
  background: #f0f0f0;
}

.qty-input {
  width: 60px;
  height: 40px;
  border: none;
  border-left: 1px solid #ddd;
  border-right: 1px solid #ddd;
  text-align: center;
  font-size: 16px;
  appearance: textfield;
}

.add-to-cart-btn {
  padding: 12px 24px;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.3s;
}

.add-to-cart-btn.primary {
  background: #28a745;
  color: white;
  flex: 1;
}

.add-to-cart-btn.primary:hover:not(:disabled) {
  background: #218838;
}

.add-to-cart-btn.primary:disabled {
  background: #df8686;
  cursor: not-allowed;
}

.add-to-cart-btn.secondary {
  background: white;
  color: #007bff;
  border: 2px solid #007bff;
}

.add-to-cart-btn.secondary:hover {
  background: #007bff;
  color: white;
}

/* –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—à–∏–±–∫–∏ */
.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 400px;
  gap: 20px;
}

.spinner {
  width: 50px;
  height: 50px;
  border: 4px solid #f3f3f3;
  border-top: 4px solid #007bff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.error-state {
  text-align: center;
  padding: 60px 20px;
}

.error-state h2 {
  color: #dc3545;
  margin-bottom: 15px;
}

.error-state p {
  color: #666;
  margin-bottom: 20px;
}

.back-to-home {
  display: inline-block;
  padding: 10px 20px;
  background: #007bff;
  color: white;
  text-decoration: none;
  border-radius: 6px;
}

.back-to-home:hover {
  background: #0056b3;
}

/* –ü–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã */
.related-products {
  margin-top: 40px;
  padding-top: 40px;
  border-top: 1px solid #eee;
}

.related-products h2 {
  margin-bottom: 20px;
  color: #333;
}

.related-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
}

.related-card {
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s;
}

.related-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.related-image {
  height: 200px;
  overflow: hidden;
  background: #f8f9fa;
}

.related-image img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.related-info {
  padding: 15px;
}

.related-info h4 {
  margin: 0 0 10px 0;
  font-size: 16px;
  color: #333;
}

.related-price {
  font-size: 18px;
  font-weight: bold;
  color: #007bff;
  margin: 0;
}
</style>
//src\pages\shared\ProfileSubPage.vue
<template>
  <div class="profile-page">
    <h2>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
    <div v-if="authStore.userInfo" class="profile-info">
      <p><strong>–ò–º—è:</strong> {{ authStore.userInfo.displayName }}</p>
      <p><strong>–õ–æ–≥–∏–Ω:</strong> {{ authStore.userInfo.login }}</p>
      <p><strong>Email:</strong> {{ authStore.userInfo.email }}</p>
      <p><strong>–†–æ–ª—å:</strong> {{ authStore.userInfo.role }}</p>

      <BaseButton @click="handleLogout" variant="secondary">
        –í—ã–π—Ç–∏
      </BaseButton>
    </div>
  </div>
</template>

<script setup>
import { useRouter } from 'vue-router';
import { useAuthStore } from '../../stores/auth.js';
import BaseButton from '../../components/ui/BaseButton.vue';

const router = useRouter();
const authStore = useAuthStore();

const handleLogout = async () => {
  await authStore.logout();
  router.push('/');
};
</script>

<style scoped>
.profile-page {
  max-width: 600px;
  margin: 0 auto;
  padding: 2rem;
}

.profile-info {
  background: #f8f9fa;
  padding: 2rem;
  border-radius: 8px;
  margin-top: 1rem;
}
</style>
//src\pages\user\CartSubPage.vue
<!-- –í src/pages/user/CartSubPage.vue -->
<template>
  <div class="cart-page">
    <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>

    <div v-if="cartStore.isLoading" class="loading">
      <div class="spinner"></div>
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã...</p>
    </div>

    <div v-else-if="cartStore.error" class="error">
      <p>‚ùå {{ cartStore.error }}</p>
      <BaseButton @click="loadCart" variant="outline">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</BaseButton>
    </div>

    <div v-else-if="cartStore.isEmpty" class="empty-cart">
      <p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
      <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã</p>
      <router-link to="/main">
        <BaseButton variant="primary">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</BaseButton>
      </router-link>
    </div>

    <div v-else class="cart-content">
      <div class="cart-items">
        <div v-for="item in cartStore.items" :key="item.productId" class="cart-item">
          <div class="item-image">
            <img
                :src="getProductImage(item.product)"
                :alt="item.product.name"
            >
          </div>

          <div class="item-details">
            <h3 class="item-name">{{ item.product.name }}</h3>
            <p class="item-price">{{ formatPrice(item.product.price) }} ‚ÇΩ</p>
            <p class="item-stock">–í –Ω–∞–ª–∏—á–∏–∏: {{ item.product.stock }} —à—Ç.</p>

            <div class="item-controls">
              <div class="quantity-control">
                <button
                    class="qty-btn minus"
                    @click="decreaseQuantity(item.productId)"
                    :disabled="item.quantity <= 1"
                >-</button>
                <input
                    type="number"
                    v-model.number="item.quantity"
                    min="1"
                    :max="item.product.stock"
                    @change="updateQuantity(item.productId, item.quantity)"
                    class="qty-input"
                >
                <button
                    class="qty-btn plus"
                    @click="increaseQuantity(item.productId)"
                    :disabled="item.quantity >= item.product.stock"
                >+</button>
              </div>

              <button
                  class="remove-btn"
                  @click="removeItem(item.productId)"
              >
                –£–¥–∞–ª–∏—Ç—å
              </button>
            </div>
          </div>

          <div class="item-total">
            <div class="total-price">{{ formatPrice(item.itemTotal) }} ‚ÇΩ</div>
            <div class="item-quantity">√ó {{ item.quantity }} —à—Ç.</div>
          </div>
        </div>
      </div>

      <div class="cart-summary">
        <div class="summary-header">
          <h3>–ò—Ç–æ–≥–æ</h3>
        </div>

        <div class="summary-details">
          <div class="summary-row">
            <span>–¢–æ–≤–∞—Ä—ã ({{ cartStore.totalItems }})</span>
            <span>{{ formatPrice(cartStore.cartTotalPrice) }} ‚ÇΩ</span>
          </div>
          <div class="summary-row">
            <span>–î–æ—Å—Ç–∞–≤–∫–∞</span>
            <span>–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
          </div>
          <div class="summary-row total">
            <span>–û–±—â–∞—è —Å—É–º–º–∞</span>
            <span class="total-price">{{ formatPrice(cartStore.cartTotalPrice) }} ‚ÇΩ</span>
          </div>
        </div>

        <div class="cart-actions">
          <BaseButton
              @click="clearCart"
              variant="outline"
              class="clear-btn"
              :disabled="cartStore.isLoading"
          >
            –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
          </BaseButton>

          <BaseButton
              @click="goToCheckout"
              variant="primary"
              class="checkout-btn"
              :disabled="cartStore.isLoading || cartStore.isEmpty"
          >
            –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
          </BaseButton>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { onMounted } from 'vue';
import { useCartStore } from '../../stores/cart.js';
import { useAuthStore } from '../../stores/auth.js';
import BaseButton from '../../components/ui/BaseButton.vue';
import { useRouter } from 'vue-router';

const cartStore = useCartStore();
const authStore = useAuthStore();
const router = useRouter();

const imagePlaceholder = '/src/uploads/product_placeholder.png';

const getProductImage = (product) => {
  return product.images && product.images.length > 0 ? product.images[0] : imagePlaceholder;
};

const formatPrice = (price) => {
  return new Intl.NumberFormat('ru-RU').format(price);
};

const loadCart = async () => {
  await cartStore.loadCart();
};

const increaseQuantity = async (productId) => {
  const item = cartStore.getCartItem(productId);
  if (item && item.quantity < item.product.stock) {
    await cartStore.updateCartItem(productId, item.quantity + 1);
  }
};

const decreaseQuantity = async (productId) => {
  const item = cartStore.getCartItem(productId);
  if (item && item.quantity > 1) {
    await cartStore.updateCartItem(productId, item.quantity - 1);
  }
};

const updateQuantity = async (productId, quantity) => {
  if (quantity < 1) {
    quantity = 1;
  }

  const item = cartStore.getCartItem(productId);
  if (item && quantity <= item.product.stock) {
    await cartStore.updateCartItem(productId, quantity);
  } else {
    // –ï—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –±–æ–ª—å—à–µ, —á–µ–º –µ—Å—Ç—å –Ω–∞ —Å–∫–ª–∞–¥–µ, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É
    loadCart();
  }
};

const removeItem = async (productId) => {
  if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?')) {
    await cartStore.removeFromCart(productId);
  }
};

const clearCart = async () => {
  if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∫–æ—Ä–∑–∏–Ω—É?')) {
    await cartStore.clearCart();
  }
};

const goToCheckout = () => {
  router.push('/checkout');
};

onMounted(async () => {
  if (!authStore.isAuthenticated) {
    router.push('/auth');
    return;
  }
  await loadCart();
});
</script>

<style scoped>
.cart-page {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.loading, .error, .empty-cart {
  text-align: center;
  padding: 3rem;
  background: #f8f9fa;
  border-radius: 8px;
  margin: 1rem 0;
}

.error {
  color: #dc3545;
  background: #f8d7da;
}

.empty-cart {
  color: #6c757d;
}

.spinner {
  border: 3px solid #f3f3f3;
  border-top: 3px solid #007bff;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 0 auto 1rem;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.cart-content {
  display: grid;
  grid-template-columns: 1fr 350px;
  gap: 2rem;
  margin-top: 1rem;
}

@media (max-width: 900px) {
  .cart-content {
    grid-template-columns: 1fr;
  }
}

.cart-items {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.cart-item {
  display: flex;
  background: white;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  padding: 1rem;
  gap: 1rem;
  align-items: center;
}

.item-image {
  width: 100px;
  height: 100px;
  flex-shrink: 0;
}

.item-image img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  border-radius: 4px;
}

.item-details {
  flex: 1;
}

.item-name {
  margin: 0 0 0.5rem 0;
  font-size: 1rem;
}

.item-price {
  font-weight: bold;
  color: #007bff;
  margin: 0 0 0.25rem 0;
}

.item-stock {
  color: #6c757d;
  font-size: 0.9rem;
  margin: 0 0 0.5rem 0;
}

.item-controls {
  display: flex;
  gap: 1rem;
  align-items: center;
}

.quantity-control {
  display: flex;
  align-items: center;
  border: 1px solid #ddd;
  border-radius: 4px;
  overflow: hidden;
}

.qty-btn {
  width: 30px;
  height: 30px;
  background: white;
  border: none;
  font-size: 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.qty-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.qty-btn:hover:not(:disabled) {
  background: #f0f0f0;
}

.qty-input {
  width: 40px;
  height: 30px;
  border: none;
  border-left: 1px solid #ddd;
  border-right: 1px solid #ddd;
  text-align: center;
  font-size: 14px;
}

.remove-btn {
  background: none;
  border: none;
  color: #dc3545;
  cursor: pointer;
  font-size: 14px;
}

.remove-btn:hover {
  text-decoration: underline;
}

.item-total {
  text-align: right;
  min-width: 100px;
}

.total-price {
  font-size: 1.2rem;
  font-weight: bold;
  color: #333;
}

.item-quantity {
  color: #6c757d;
  font-size: 0.9rem;
}

.cart-summary {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 1.5rem;
  align-self: flex-start;
}

.summary-header {
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid #dee2e6;
}

.summary-header h3 {
  margin: 0;
}

.summary-details {
  margin-bottom: 1.5rem;
}

.summary-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.5rem;
  padding: 0.5rem 0;
}

.summary-row.total {
  border-top: 1px solid #dee2e6;
  margin-top: 0.5rem;
  padding-top: 1rem;
  font-weight: bold;
}

.total-price {
  color: #28a745;
  font-size: 1.3rem;
}

.cart-actions {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.clear-btn {
  color: #dc3545;
  border-color: #dc3545;
}

.clear-btn:hover {
  background: #dc3545;
  color: white;
}

.checkout-btn {
  background: #28a745;
  border-color: #28a745;
}

.checkout-btn:hover {
  background: #218838;
  border-color: #1e7e34;
}
</style>
//src\pages\user\CheckoutPage.vue
<template>
  <div class="checkout-page">
    <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>

    <div v-if="cartStore.isEmpty" class="empty-cart">
      <p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
      <router-link to="/main">
        <BaseButton variant="primary">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</BaseButton>
      </router-link>
    </div>

    <div v-else class="checkout-content">
      <div class="checkout-layout">
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–∞—Ö -->
        <div class="cart-summary">
          <h3>–¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ</h3>
          <div class="cart-items-list">
            <div v-for="item in cartStore.items" :key="item.productId" class="checkout-item">
              <div class="item-image">
                <img :src="getProductImage(item.product)" :alt="item.product.name">
              </div>
              <div class="item-details">
                <h4>{{ item.product.name }}</h4>
                <div class="item-price">{{ formatPrice(item.product.price) }} ‚ÇΩ √ó {{ item.quantity }} —à—Ç.</div>
                <div class="item-total">{{ formatPrice(item.itemTotal) }} ‚ÇΩ</div>
              </div>
            </div>
          </div>
          <div class="cart-total">
            <div class="total-row">
              <span>–ò—Ç–æ–≥–æ:</span>
              <span class="total-amount">{{ formatPrice(cartStore.cartTotalPrice) }} ‚ÇΩ</span>
            </div>
          </div>
        </div>

        <!-- –§–æ—Ä–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ -->
        <div class="checkout-form">
          <form @submit.prevent="handleSubmit">
            <!-- –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏ -->
            <div class="form-section">
              <h3>–î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏</h3>

              <BaseInput
                  id="deliveryAddress"
                  label="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ *"
                  v-model="form.deliveryInfo.address"
                  placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞"
                  required
                  :error="formErrors.deliveryAddress"
              />

              <div class="form-group">
                <label for="deliveryTime">–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ *</label>
                <input
                    id="deliveryTime"
                    type="datetime-local"
                    v-model="form.deliveryInfo.deliveryTime"
                    required
                    class="datetime-input"
                    :min="minDeliveryDate"
                />
                <div v-if="formErrors.deliveryTime" class="input-error">{{ formErrors.deliveryTime }}</div>
              </div>

              <BaseInput
                  id="courierNotes"
                  label="–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –¥–ª—è –∫—É—Ä—å–µ—Ä–∞"
                  v-model="form.deliveryInfo.courierNotes"
                  placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ–∑–≤–æ–Ω–∏—Ç—å –∑–∞—Ä–∞–Ω–µ–µ"
                  type="textarea"
              />
            </div>

            <!-- –î–∞–Ω–Ω—ã–µ –æ–ø–ª–∞—Ç—ã -->
            <div class="form-section">
              <h3>–î–∞–Ω–Ω—ã–µ –æ–ø–ª–∞—Ç—ã</h3>

              <BaseInput
                  id="cardNumber"
                  label="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã *"
                  v-model="form.paymentInfo.cardNumber"
                  placeholder="0000 0000 0000 0000"
                  required
                  :error="formErrors.cardNumber"
                  @input="formatCardNumber"
              />

              <div class="payment-row">
                <div class="payment-field">
                  <BaseInput
                      id="expirationDate"
                      label="–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è *"
                      v-model="form.paymentInfo.expirationDate"
                      placeholder="MM/YY"
                      required
                      :error="formErrors.expirationDate"
                      @input="formatExpirationDate"
                  />
                </div>
                <div class="payment-field">
                  <BaseInput
                      id="cvc"
                      label="CVC/CVV *"
                      v-model="form.paymentInfo.cvc"
                      placeholder="123"
                      type="password"
                      maxlength="3"
                      required
                      :error="formErrors.cvc"
                  />
                </div>
              </div>
            </div>

            <!-- –°–æ–≥–ª–∞—Å–∏–µ —Å —É—Å–ª–æ–≤–∏—è–º–∏ -->
            <div class="form-section">
              <div class="checkbox-group">
                <input
                    type="checkbox"
                    id="terms"
                    v-model="form.acceptTerms"
                    required
                    class="checkbox-input"
                />
                <label for="terms" class="checkbox-label">
                  –Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å —É—Å–ª–æ–≤–∏—è–º–∏ –ø–æ–∫—É–ø–∫–∏ –∏ –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                </label>
                <div v-if="formErrors.acceptTerms" class="input-error">{{ formErrors.acceptTerms }}</div>
              </div>
            </div>

            <div v-if="ordersStore.error" class="form-error">
              {{ ordersStore.error }}
            </div>

            <div class="form-actions">
              <router-link to="/cart">
                <BaseButton variant="outline" type="button">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–æ—Ä–∑–∏–Ω—É</BaseButton>
              </router-link>

              <BaseButton
                  type="submit"
                  :disabled="ordersStore.isLoading || !form.acceptTerms"
                  variant="primary"
                  class="submit-button"
              >
                {{ ordersStore.isLoading ? '–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ...' : '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑' }}
              </BaseButton>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted } from 'vue';
import { useRouter } from 'vue-router';
import { useCartStore } from '../../stores/cart.js';
import { useOrdersStore } from '../../stores/orders.js';
import BaseInput from '../../components/ui/BaseInput.vue';
import BaseButton from '../../components/ui/BaseButton.vue';

const router = useRouter();
const cartStore = useCartStore();
const ordersStore = useOrdersStore();

const imagePlaceholder = '/src/uploads/product_placeholder.png';

const form = reactive({
  deliveryInfo: {
    address: '',
    deliveryTime: '',
    courierNotes: ''
  },
  paymentInfo: {
    cardNumber: '',
    expirationDate: '',
    cvc: ''
  },
  acceptTerms: false
});

const formErrors = ref({});

const minDeliveryDate = computed(() => {
  const now = new Date();
  now.setHours(now.getHours() + 2); // –ú–∏–Ω–∏–º—É–º —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞
  return now.toISOString().slice(0, 16);
});

const validateForm = () => {
  const errors = {};

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞
  if (!form.deliveryInfo.address.trim()) {
    errors.deliveryAddress = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
  if (!form.deliveryInfo.deliveryTime) {
    errors.deliveryTime = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
  } else {
    const deliveryDate = new Date(form.deliveryInfo.deliveryTime);
    const minDate = new Date(minDeliveryDate.value);
    if (deliveryDate < minDate) {
      errors.deliveryTime = '–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ —Ä–∞–Ω—å—à–µ —á–µ–º —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞';
    }
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã
  const cardNumber = form.paymentInfo.cardNumber.replace(/\s/g, '');
  if (!cardNumber) {
    errors.cardNumber = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
  } else if (!/^\d{16}$/.test(cardNumber)) {
    errors.cardNumber = '–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 16 —Ü–∏—Ñ—Ä';
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
  if (!form.paymentInfo.expirationDate) {
    errors.expirationDate = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
  } else if (!/^\d{2}\/\d{2}$/.test(form.paymentInfo.expirationDate)) {
    errors.expirationDate = '–§–æ—Ä–º–∞—Ç: MM/YY';
  } else {
    const [month, year] = form.paymentInfo.expirationDate.split('/');
    const expDate = new Date(2000 + parseInt(year), parseInt(month) - 1);
    const today = new Date();
    if (expDate < today) {
      errors.expirationDate = '–ö–∞—Ä—Ç–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞';
    }
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è CVC
  if (!form.paymentInfo.cvc) {
    errors.cvc = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
  } else if (!/^\d{3}$/.test(form.paymentInfo.cvc)) {
    errors.cvc = 'CVC –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 3 —Ü–∏—Ñ—Ä—ã';
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–≥–ª–∞—Å–∏—è
  if (!form.acceptTerms) {
    errors.acceptTerms = '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å —É—Å–ª–æ–≤–∏—è–º–∏';
  }

  formErrors.value = errors;
  return Object.keys(errors).length === 0;
};

const formatCardNumber = () => {
  let value = form.paymentInfo.cardNumber.replace(/\D/g, '');
  value = value.substring(0, 16);
  const formatted = value.replace(/(\d{4})/g, '$1 ').trim();
  form.paymentInfo.cardNumber = formatted;
};

const formatExpirationDate = () => {
  let value = form.paymentInfo.expirationDate.replace(/\D/g, '');
  if (value.length >= 2) {
    value = value.substring(0, 2) + '/' + value.substring(2, 4);
  }
  form.paymentInfo.expirationDate = value;
};

const getProductImage = (product) => {
  return product.images && product.images.length > 0 ? product.images[0] : imagePlaceholder;
};

const formatPrice = (price) => {
  return new Intl.NumberFormat('ru-RU').format(price);
};

const handleSubmit = async () => {
  if (!validateForm()) return;

  ordersStore.clearError();

  // –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –∑–∞–∫–∞–∑
  const orderResult = await ordersStore.createOrderFromCart();

  if (!orderResult.success) {
    return;
  }

  const orderId = orderResult.order._id;

  // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–∫–∞–∑ —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –æ–ø–ª–∞—Ç—ã
  const updateData = {
    deliveryInfo: {
      address: form.deliveryInfo.address.trim(),
      deliveryTime: new Date(form.deliveryInfo.deliveryTime).toISOString(),
      courierNotes: form.deliveryInfo.courierNotes.trim()
    },
    paymentInfo: {
      cardNumber: form.paymentInfo.cardNumber.replace(/\s/g, ''),
      cvc: form.paymentInfo.cvc,
      expirationDate: form.paymentInfo.expirationDate
    }
  };

  const updateResult = await ordersStore.updateOrder(orderId, updateData);

  if (!updateResult.success) {
    return;
  }

  // –û–ø–ª–∞—á–∏–≤–∞–µ–º –∑–∞–∫–∞–∑
  const paymentData = {
    cardNumber: form.paymentInfo.cardNumber.replace(/\s/g, ''),
    cvc: form.paymentInfo.cvc,
    expirationDate: form.paymentInfo.expirationDate
  };

  const paymentResult = await ordersStore.payOrder(orderId, paymentData);

  if (paymentResult.success) {
    // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
    await cartStore.clearCart();

    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–∫–∞–∑–∞
    router.push(`/orders/${orderId}`);
  }
};

onMounted(() => {
  if (!cartStore.cart) {
    cartStore.loadCart();
  }
});
</script>

<style scoped>
.checkout-page {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.empty-cart {
  text-align: center;
  padding: 3rem;
  background: #f8f9fa;
  border-radius: 8px;
  margin: 1rem 0;
}

.checkout-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
  margin-top: 1rem;
}

@media (max-width: 900px) {
  .checkout-layout {
    grid-template-columns: 1fr;
  }
}

.cart-summary {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 1.5rem;
  align-self: flex-start;
}

.checkout-item {
  display: flex;
  gap: 1rem;
  padding: 1rem 0;
  border-bottom: 1px solid #dee2e6;
}

.checkout-item:last-child {
  border-bottom: none;
}

.item-image {
  width: 80px;
  height: 80px;
  flex-shrink: 0;
}

.item-image img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  border-radius: 4px;
}

.item-details {
  flex: 1;
}

.item-details h4 {
  margin: 0 0 0.5rem 0;
  font-size: 1rem;
}

.item-price {
  color: #6c757d;
  font-size: 0.9rem;
}

.item-total {
  font-weight: bold;
  margin-top: 0.25rem;
}

.cart-total {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 2px solid #dee2e6;
}

.total-row {
  display: flex;
  justify-content: space-between;
  font-size: 1.2rem;
  font-weight: bold;
}

.total-amount {
  color: #28a745;
}

.checkout-form {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.form-section {
  margin-bottom: 2rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid #eee;
}

.form-section:last-child {
  border-bottom: none;
}

.form-section h3 {
  margin-bottom: 1rem;
  color: #333;
}

.form-group {
  margin-bottom: 1rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
}

.datetime-input {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 1rem;
}

.datetime-input:focus {
  outline: none;
  border-color: #007bff;
}

.payment-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.payment-field {
  flex: 1;
}

.checkbox-group {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
}

.checkbox-input {
  margin-top: 0.25rem;
}

.checkbox-label {
  font-size: 0.9rem;
  line-height: 1.4;
  cursor: pointer;
}

.form-actions {
  display: flex;
  justify-content: space-between;
  gap: 1rem;
  margin-top: 2rem;
}

.submit-button {
  flex: 1;
  max-width: 200px;
}

.form-error {
  color: #dc3545;
  margin: 1rem 0;
  padding: 1rem;
  background: #f8d7da;
  border-radius: 6px;
}

.input-error {
  color: #dc3545;
  font-size: 0.875rem;
  margin-top: 0.25rem;
}
</style>
//src\pages\user\OrderDetailsPage.vue
<template>
  <div class="order-details-page">
    <div v-if="ordersStore.isLoading && !ordersStore.currentOrder" class="loading">
      <div class="spinner"></div>
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–∫–∞–∑–µ...</p>
    </div>

    <div v-else-if="ordersStore.error" class="error">
      <p>‚ùå {{ ordersStore.error }}</p>
      <BaseButton @click="loadOrder" variant="outline">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</BaseButton>
    </div>

    <div v-else-if="!ordersStore.currentOrder" class="not-found">
      <h2>–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω</h2>
      <p>–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–π –∑–∞–∫–∞–∑ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –∫ –Ω–µ–º—É –¥–æ—Å—Ç—É–ø–∞.</p>
      <router-link to="/orders">
        <BaseButton variant="primary">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–∫–∞–∑–∞–º</BaseButton>
      </router-link>
    </div>

    <div v-else class="order-details">
      <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
      <nav class="breadcrumbs">
        <router-link to="/orders" class="breadcrumb-link">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</router-link>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current">–ó–∞–∫–∞–∑ ‚Ññ{{ orderNumber }}</span>
      </nav>

      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–∫–∞–∑–∞ -->
      <div class="order-header">
        <div class="header-left">
          <h2>–ó–∞–∫–∞–∑ ‚Ññ{{ orderNumber }}</h2>
          <div class="order-meta">
            <span class="order-date">{{ formatDate(order.createdAt) }}</span>
            <span :class="['order-status', getStatusClass(order.status)]">
              {{ order.status }}
            </span>
          </div>
        </div>

        <div class="header-right">
          <div class="order-total">
            <span class="total-label">–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞:</span>
            <span class="total-amount">{{ formatPrice(order.totalPrice) }} ‚ÇΩ</span>
          </div>
        </div>
      </div>

      <!-- –î–µ–π—Å—Ç–≤–∏—è —Å –∑–∞–∫–∞–∑–æ–º -->
      <div v-if="canPerformActions" class="order-actions-panel">
        <template v-if="order.status === ordersStore.orderStatuses.NEW">
          <BaseButton @click="startEditing" variant="primary">
            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –æ–ø–ª–∞—Ç–∏—Ç—å
          </BaseButton>
          <BaseButton @click="handleCancel" variant="outline" class="cancel-btn">
            –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑
          </BaseButton>
        </template>

        <template v-else-if="order.status === ordersStore.orderStatuses.PAID">
          <BaseButton @click="startEditing" variant="outline">
            –ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏
          </BaseButton>
        </template>

        <template v-else-if="order.status === ordersStore.orderStatuses.DELIVERED">
          <div class="delivered-info">
            <span>‚úÖ –ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω</span>
          </div>
        </template>
      </div>

      <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
      <div v-if="isEditing" class="edit-form-container">
        <h3>{{ order.status === ordersStore.orderStatuses.NEW ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞' : '–ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∞–≤–∫–∏' }}</h3>

        <form @submit.prevent="handleUpdate">
          <!-- –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏ -->
          <div class="form-section">
            <h4>–î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏</h4>

            <BaseInput
                id="editAddress"
                label="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ *"
                v-model="editForm.deliveryInfo.address"
                placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞"
                required
                :error="editErrors.address"
                :disabled="!ordersStore.canEditDelivery"
            />

            <div class="form-group">
              <label for="editDeliveryTime">–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ *</label>
              <input
                  id="editDeliveryTime"
                  type="datetime-local"
                  v-model="editForm.deliveryInfo.deliveryTime"
                  required
                  class="datetime-input"
                  :min="minDeliveryDate"
                  :disabled="!ordersStore.canEditDelivery"
              />
              <div v-if="editErrors.deliveryTime" class="input-error">{{ editErrors.deliveryTime }}</div>
            </div>

            <BaseInput
                id="editCourierNotes"
                label="–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –¥–ª—è –∫—É—Ä—å–µ—Ä–∞"
                v-model="editForm.deliveryInfo.courierNotes"
                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ–∑–≤–æ–Ω–∏—Ç—å –∑–∞—Ä–∞–Ω–µ–µ"
                type="textarea"
                :disabled="!ordersStore.canEditDelivery"
            />
          </div>

          <!-- –î–∞–Ω–Ω—ã–µ –æ–ø–ª–∞—Ç—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤) -->
          <div v-if="order.status === ordersStore.orderStatuses.NEW" class="form-section">
            <h4>–î–∞–Ω–Ω—ã–µ –æ–ø–ª–∞—Ç—ã</h4>

            <BaseInput
                id="editCardNumber"
                label="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã *"
                v-model="editForm.paymentInfo.cardNumber"
                placeholder="0000 0000 0000 0000"
                required
                :error="editErrors.cardNumber"
                @input="formatCardNumber"
            />

            <div class="payment-row">
              <div class="payment-field">
                <BaseInput
                    id="editExpirationDate"
                    label="–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è *"
                    v-model="editForm.paymentInfo.expirationDate"
                    placeholder="MM/YY"
                    required
                    :error="editErrors.expirationDate"
                    @input="formatExpirationDate"
                />
              </div>
              <div class="payment-field">
                <BaseInput
                    id="editCvc"
                    label="CVC/CVV *"
                    v-model="editForm.paymentInfo.cvc"
                    placeholder="123"
                    type="password"
                    maxlength="3"
                    required
                    :error="editErrors.cvc"
                />
              </div>
            </div>
          </div>

          <div v-if="updateError" class="form-error">
            {{ updateError }}
          </div>

          <div class="edit-actions">
            <BaseButton @click="cancelEditing" variant="outline" type="button">
              –û—Ç–º–µ–Ω–∞
            </BaseButton>

            <BaseButton
                type="submit"
                :disabled="isUpdating"
                variant="primary"
                class="submit-button"
            >
              {{ isUpdating ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è' }}
            </BaseButton>

            <BaseButton
                v-if="order.status === ordersStore.orderStatuses.NEW"
                @click="handlePayOnly"
                :disabled="isUpdating"
                variant="secondary"
                class="pay-button"
            >
              –¢–æ–ª—å–∫–æ –æ–ø–ª–∞—Ç–∏—Ç—å
            </BaseButton>
          </div>
        </form>
      </div>

      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ -->
      <div class="order-info">
        <!-- –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ -->
        <div class="order-items-section">
          <h3>–¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ</h3>
          <div class="items-list">
            <div v-for="item in order.items" :key="item.productId" class="order-item">
              <div class="item-image">
                <img :src="getProductImage(item.product)" :alt="item.product?.name">
              </div>
              <div class="item-details">
                <h4>{{ item.product?.name || '–¢–æ–≤–∞—Ä' }}</h4>
                <div class="item-price">{{ formatPrice(item.product?.price || 0) }} ‚ÇΩ √ó {{ item.quantity }} —à—Ç.</div>
                <div class="item-total">{{ formatPrice(item.itemTotal) }} ‚ÇΩ</div>
              </div>
            </div>
          </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ -->
        <div class="delivery-info-section">
          <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ</h3>
          <div class="info-grid">
            <div class="info-row">
              <span class="info-label">–ê–¥—Ä–µ—Å:</span>
              <span class="info-value">{{ order.deliveryInfo?.address || '–ù–µ —É–∫–∞–∑–∞–Ω' }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏:</span>
              <span class="info-value">{{ formatDateTime(order.deliveryInfo?.deliveryTime) }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:</span>
              <span class="info-value">{{ order.deliveryInfo?.courierNotes || '–ù–µ —É–∫–∞–∑–∞–Ω—ã' }}</span>
            </div>
          </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ -->
        <div v-if="order.paymentInfo" class="payment-info-section">
          <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø–ª–∞—Ç–µ</h3>
          <div class="info-grid">
            <div class="info-row">
              <span class="info-label">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</span>
              <span class="info-value">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</span>
            </div>
            <div class="info-row">
              <span class="info-label">–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã:</span>
              <span class="info-value">**** **** **** {{ order.paymentInfo.cardNumber?.slice(-4) }}</span>
            </div>
            <div v-if="order.paymentDate" class="info-row">
              <span class="info-label">–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã:</span>
              <span class="info-value">{{ formatDate(order.paymentDate) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, computed, onMounted, watch } from 'vue';
import { useRoute, useRouter } from 'vue-router';
import { useOrdersStore } from '../../stores/orders.js';
import BaseInput from '../../components/ui/BaseInput.vue';
import BaseButton from '../../components/ui/BaseButton.vue';

const route = useRoute();
const router = useRouter();
const ordersStore = useOrdersStore();

const isEditing = ref(false);
const isUpdating = ref(false);
const updateError = ref('');

const editForm = reactive({
  deliveryInfo: {
    address: '',
    deliveryTime: '',
    courierNotes: ''
  },
  paymentInfo: {
    cardNumber: '',
    expirationDate: '',
    cvc: ''
  }
});

const editErrors = ref({});

const order = computed(() => ordersStore.currentOrder);
const orderNumber = computed(() => order.value?._id?.slice(-8).toUpperCase() || '');

const canPerformActions = computed(() => {
  if (!order.value) return false;
  const status = order.value.status;
  return status === ordersStore.orderStatuses.NEW ||
      status === ordersStore.orderStatuses.PAID;
});

const minDeliveryDate = computed(() => {
  const now = new Date();
  now.setHours(now.getHours() + 2);
  return now.toISOString().slice(0, 16);
});

const loadOrder = async () => {
  await ordersStore.loadOrder(route.params.orderId);

  if (order.value) {
    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É —Ç–µ–∫—É—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
    editForm.deliveryInfo = {
      address: order.value.deliveryInfo?.address || '',
      deliveryTime: order.value.deliveryInfo?.deliveryTime
          ? new Date(order.value.deliveryInfo.deliveryTime).toISOString().slice(0, 16)
          : '',
      courierNotes: order.value.deliveryInfo?.courierNotes || ''
    };

    if (order.value.paymentInfo) {
      editForm.paymentInfo.cardNumber = order.value.paymentInfo.cardNumber || '';
      editForm.paymentInfo.expirationDate = order.value.paymentInfo.expirationDate || '';
    }
  }
};

const startEditing = () => {
  isEditing.value = true;
  updateError.value = '';
};

const cancelEditing = () => {
  isEditing.value = false;
  loadOrder(); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∫ –∏—Å—Ö–æ–¥–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º
};

const validateEditForm = () => {
  const errors = {};

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞
  if (!editForm.deliveryInfo.address.trim()) {
    errors.address = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
  if (!editForm.deliveryInfo.deliveryTime) {
    errors.deliveryTime = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
  } else {
    const deliveryDate = new Date(editForm.deliveryInfo.deliveryTime);
    const minDate = new Date(minDeliveryDate.value);
    if (deliveryDate < minDate) {
      errors.deliveryTime = '–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ —Ä–∞–Ω—å—à–µ —á–µ–º —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞';
    }
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤
  if (order.value.status === ordersStore.orderStatuses.NEW) {
    const cardNumber = editForm.paymentInfo.cardNumber.replace(/\s/g, '');
    if (!cardNumber) {
      errors.cardNumber = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
    } else if (!/^\d{16}$/.test(cardNumber)) {
      errors.cardNumber = '–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 16 —Ü–∏—Ñ—Ä';
    }

    if (!editForm.paymentInfo.expirationDate) {
      errors.expirationDate = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
    } else if (!/^\d{2}\/\d{2}$/.test(editForm.paymentInfo.expirationDate)) {
      errors.expirationDate = '–§–æ—Ä–º–∞—Ç: MM/YY';
    }

    if (!editForm.paymentInfo.cvc) {
      errors.cvc = '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ';
    } else if (!/^\d{3}$/.test(editForm.paymentInfo.cvc)) {
      errors.cvc = 'CVC –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 3 —Ü–∏—Ñ—Ä—ã';
    }
  }

  editErrors.value = errors;
  return Object.keys(errors).length === 0;
};

const formatCardNumber = () => {
  let value = editForm.paymentInfo.cardNumber.replace(/\D/g, '');
  value = value.substring(0, 16);
  const formatted = value.replace(/(\d{4})/g, '$1 ').trim();
  editForm.paymentInfo.cardNumber = formatted;
};

const formatExpirationDate = () => {
  let value = editForm.paymentInfo.expirationDate.replace(/\D/g, '');
  if (value.length >= 2) {
    value = value.substring(0, 2) + '/' + value.substring(2, 4);
  }
  editForm.paymentInfo.expirationDate = value;
};

const handleUpdate = async () => {
  if (!validateEditForm()) return;

  isUpdating.value = true;
  updateError.value = '';

  try {
    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    const updateData = {
      deliveryInfo: {
        address: editForm.deliveryInfo.address.trim(),
        deliveryTime: new Date(editForm.deliveryInfo.deliveryTime).toISOString(),
        courierNotes: editForm.deliveryInfo.courierNotes.trim()
      }
    };

    // –î–ª—è –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –¥–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ–ø–ª–∞—Ç—ã
    if (order.value.status === ordersStore.orderStatuses.NEW) {
      updateData.paymentInfo = {
        cardNumber: editForm.paymentInfo.cardNumber.replace(/\s/g, ''),
        cvc: editForm.paymentInfo.cvc,
        expirationDate: editForm.paymentInfo.expirationDate
      };
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–∫–∞–∑
    const updateResult = await ordersStore.updateOrder(order.value._id, updateData);

    if (!updateResult.success) {
      updateError.value = updateResult.error || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞';
      return;
    }

    // –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –Ω–æ–≤—ã–π –∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–ø–ª–∞—Ç—ã, –≤—ã–ø–æ–ª–Ω—è–µ–º –æ–ø–ª–∞—Ç—É
    if (order.value.status === ordersStore.orderStatuses.NEW && editForm.paymentInfo.cardNumber) {
      const paymentData = {
        cardNumber: editForm.paymentInfo.cardNumber.replace(/\s/g, ''),
        cvc: editForm.paymentInfo.cvc,
        expirationDate: editForm.paymentInfo.expirationDate
      };

      const paymentResult = await ordersStore.payOrder(order.value._id, paymentData);

      if (!paymentResult.success) {
        updateError.value = paymentResult.error || '–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–∞';
        return;
      }
    }

    // –£—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ
    isEditing.value = false;

  } catch (error) {
    updateError.value = error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞';
  } finally {
    isUpdating.value = false;
  }
};

const handlePayOnly = async () => {
  if (!validateEditForm()) return;

  isUpdating.value = true;
  updateError.value = '';

  try {
    const paymentData = {
      cardNumber: editForm.paymentInfo.cardNumber.replace(/\s/g, ''),
      cvc: editForm.paymentInfo.cvc,
      expirationDate: editForm.paymentInfo.expirationDate
    };

    const paymentResult = await ordersStore.payOrder(order.value._id, paymentData);

    if (!paymentResult.success) {
      updateError.value = paymentResult.error || '–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–∞';
      return;
    }

    isEditing.value = false;

  } catch (error) {
    updateError.value = error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞';
  } finally {
    isUpdating.value = false;
  }
};

const handleCancel = async () => {
  if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑?')) return;

  const result = await ordersStore.cancelOrder(order.value._id);

  if (result.success) {
    router.push('/orders');
  }
};

const formatDate = (dateString) => {
  if (!dateString) return '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
  return new Date(dateString).toLocaleDateString('ru-RU', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric'
  });
};

const formatDateTime = (dateString) => {
  if (!dateString) return '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
  return new Date(dateString).toLocaleString('ru-RU', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
};

const formatPrice = (price) => {
  return new Intl.NumberFormat('ru-RU').format(price);
};

const getProductImage = (product) => {
  return product?.images && product.images.length > 0
      ? product.images[0]
      : '/src/uploads/product_placeholder.png';
};

const getStatusClass = (status) => {
  switch (status) {
    case '–ù–û–í–´–ô':
      return 'status-new';
    case '–û–ü–õ–ê–ß–ï–ù':
      return 'status-paid';
    case '–í–´–ü–û–õ–ù–ï–ù':
      return 'status-delivered';
    case '–û–¢–ú–ï–ù–Å–ù':
      return 'status-cancelled';
    default:
      return '';
  }
};

onMounted(() => {
  loadOrder();
});

watch(() => route.params.orderId, (newId) => {
  if (newId) {
    loadOrder();
    isEditing.value = false;
  }
});
</script>

<style scoped>
.order-details-page {
  max-width: 1000px;
  margin: 0 auto;
  padding: 2rem;
}

.loading, .error, .not-found {
  text-align: center;
  padding: 3rem;
  background: #f8f9fa;
  border-radius: 8px;
  margin: 1rem 0;
}

.error {
  color: #dc3545;
}

.not-found {
  color: #6c757d;
}

.spinner {
  border: 3px solid #f3f3f3;
  border-top: 3px solid #007bff;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 0 auto 1rem;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.breadcrumbs {
  margin-bottom: 1rem;
  font-size: 14px;
  color: #666;
}

.breadcrumb-link {
  color: #007bff;
  text-decoration: none;
}

.breadcrumb-link:hover {
  text-decoration: underline;
}

.breadcrumb-separator {
  margin: 0 8px;
}

.breadcrumb-current {
  color: #333;
}

.order-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid #eee;
}

.header-left h2 {
  margin: 0 0 0.5rem 0;
}

.order-meta {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.order-date {
  color: #6c757d;
}

.order-status {
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.875rem;
  font-weight: 500;
}

.status-new {
  background: #fff3cd;
  color: #856404;
}

.status-paid {
  background: #d4edda;
  color: #155724;
}

.status-delivered {
  background: #d1ecf1;
  color: #0c5460;
}

.status-cancelled {
  background: #f8d7da;
  color: #721c24;
}

.order-total {
  text-align: right;
}

.total-label {
  display: block;
  color: #6c757d;
  font-size: 0.9rem;
}

.total-amount {
  font-size: 1.5rem;
  font-weight: bold;
  color: #28a745;
}

.order-actions-panel {
  display: flex;
  gap: 1rem;
  margin-bottom: 2rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 8px;
}

.cancel-btn {
  color: #dc3545;
  border-color: #dc3545;
}

.cancel-btn:hover {
  background: #dc3545;
  color: white;
}

.delivered-info {
  color: #28a745;
  font-weight: 500;
}

.edit-form-container {
  background: white;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 2rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.edit-form-container h3 {
  margin: 0 0 1.5rem 0;
  color: #333;
}

.form-section {
  margin-bottom: 2rem;
}

.form-section h4 {
  margin: 0 0 1rem 0;
  color: #555;
}

.form-group {
  margin-bottom: 1rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
}

.datetime-input {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 1rem;
}

.datetime-input:disabled {
  background: #f8f9fa;
  cursor: not-allowed;
}

.payment-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.payment-field {
  flex: 1;
}

.edit-actions {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
}

.submit-button {
  flex: 1;
}

.pay-button {
  background: #28a745;
  border-color: #28a745;
}

.pay-button:hover {
  background: #218838;
  border-color: #1e7e34;
}

.form-error {
  color: #dc3545;
  margin: 1rem 0;
  padding: 1rem;
  background: #f8d7da;
  border-radius: 6px;
}

.input-error {
  color: #dc3545;
  font-size: 0.875rem;
  margin-top: 0.25rem;
}

.order-info {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 2rem;
}

@media (max-width: 768px) {
  .order-info {
    grid-template-columns: 1fr;
  }
}

.order-items-section,
.delivery-info-section,
.payment-info-section {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 1.5rem;
}

.order-items-section h3,
.delivery-info-section h3,
.payment-info-section h3 {
  margin: 0 0 1rem 0;
  color: #333;
}

.items-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.order-item {
  display: flex;
  gap: 1rem;
  padding: 1rem;
  background: white;
  border-radius: 6px;
  border: 1px solid #dee2e6;
}

.item-image {
  width: 60px;
  height: 60px;
  flex-shrink: 0;
}

.item-image img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  border-radius: 4px;
}

.item-details {
  flex: 1;
}

.item-details h4 {
  margin: 0 0 0.5rem 0;
  font-size: 1rem;
}

.item-price {
  color: #6c757d;
  font-size: 0.9rem;
}

.item-total {
  font-weight: bold;
  margin-top: 0.25rem;
}

.info-grid {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.info-row {
  display: flex;
  justify-content: space-between;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid #e9ecef;
}

.info-row:last-child {
  border-bottom: none;
}

.info-label {
  color: #6c757d;
  font-weight: 500;
}

.info-value {
  text-align: right;
  color: #333;
}
</style>
//src\pages\user\OrdersListPage.vue
<template>
  <div class="orders-page">
    <h2>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="orders-filters">
      <div class="filter-group">
        <label for="statusFilter">–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞:</label>
        <select id="statusFilter" v-model="statusFilter" @change="loadOrders" class="filter-select">
          <option value="">–í—Å–µ –∑–∞–∫–∞–∑—ã</option>
          <option value="–ù–û–í–´–ô">–ù–æ–≤—ã–µ</option>
          <option value="–û–ü–õ–ê–ß–ï–ù">–û–ø–ª–∞—á–µ–Ω–Ω—ã–µ</option>
          <option value="–í–´–ü–û–õ–ù–ï–ù">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</option>
          <option value="–û–¢–ú–ï–ù–Å–ù">–û—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ</option>
        </select>
      </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
    <div v-if="ordersStore.isLoading && ordersStore.orders.length === 0" class="loading">
      <div class="spinner"></div>
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</p>
    </div>

    <div v-else-if="ordersStore.error" class="error">
      <p>‚ùå {{ ordersStore.error }}</p>
      <BaseButton @click="loadOrders" variant="outline">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</BaseButton>
    </div>

    <div v-else-if="ordersStore.orders.length === 0" class="empty">
      <p>üì≠ –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>
      <p>–°–æ–≤–µ—Ä—à–∏—Ç–µ –ø–µ—Ä–≤—É—é –ø–æ–∫—É–ø–∫—É –≤ –Ω–∞—à–µ–º –∫–∞—Ç–∞–ª–æ–≥–µ</p>
      <router-link to="/main">
        <BaseButton variant="primary">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</BaseButton>
      </router-link>
    </div>

    <div v-else class="orders-list">
      <div v-for="order in ordersStore.orders" :key="order._id" class="order-card">
        <div class="order-header">
          <div class="order-info">
            <h3 class="order-number">–ó–∞–∫–∞–∑ ‚Ññ{{ order._id.slice(-8).toUpperCase() }}</h3>
            <div class="order-date">{{ formatDate(order.createdAt) }}</div>
          </div>
          <div class="order-status">
            <span :class="['status-badge', getStatusClass(order.status)]">
              {{ order.status }}
            </span>
          </div>
        </div>

        <div class="order-content">
          <div class="order-items">
            <div v-for="(item, index) in order.items.slice(0, 2)" :key="index" class="order-item-preview">
              <span class="item-name">{{ item.product?.name || `–¢–æ–≤–∞—Ä #${index + 1}` }}</span>
              <span class="item-quantity">√ó {{ item.quantity }}</span>
            </div>
            <div v-if="order.items.length > 2" class="more-items">
              –∏ –µ—â—ë {{ order.items.length - 2 }} —Ç–æ–≤–∞—Ä(–æ–≤)
            </div>
          </div>

          <div class="order-total">
            <div class="total-label">–ò—Ç–æ–≥–æ:</div>
            <div class="total-amount">{{ formatPrice(order.totalPrice) }} ‚ÇΩ</div>
          </div>
        </div>

        <div class="order-actions">
          <router-link :to="`/orders/${order._id}`">
            <BaseButton variant="outline" size="small">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</BaseButton>
          </router-link>

          <template v-if="order.status === '–ù–û–í–´–ô'">
            <BaseButton @click="goToEdit(order._id)" variant="primary" size="small">
              –û–ø–ª–∞—Ç–∏—Ç—å/–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </BaseButton>
          </template>
        </div>
      </div>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <div v-if="ordersStore.pagination.totalPages > 1" class="pagination">
      <BaseButton
          @click="changePage(ordersStore.pagination.currentPage - 1)"
          :disabled="ordersStore.pagination.currentPage === 1"
          variant="outline"
      >
        –ù–∞–∑–∞–¥
      </BaseButton>

      <span class="page-info">
        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ ordersStore.pagination.currentPage }} –∏–∑ {{ ordersStore.pagination.totalPages }}
      </span>

      <BaseButton
          @click="changePage(ordersStore.pagination.currentPage + 1)"
          :disabled="ordersStore.pagination.currentPage === ordersStore.pagination.totalPages"
          variant="outline"
      >
        –í–ø–µ—Ä–µ–¥
      </BaseButton>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { useRouter } from 'vue-router';
import { useOrdersStore } from '../../stores/orders.js';
import BaseButton from '../../components/ui/BaseButton.vue';

const router = useRouter();
const ordersStore = useOrdersStore();

const statusFilter = ref('');

const loadOrders = (page = 1) => {
  ordersStore.loadOrders(page, 10, statusFilter.value);
};

const changePage = (page) => {
  if (page >= 1 && page <= ordersStore.pagination.totalPages) {
    loadOrders(page);
  }
};

const goToEdit = (orderId) => {
  router.push(`/orders/${orderId}/edit`);
};

const formatDate = (dateString) => {
  return new Date(dateString).toLocaleDateString('ru-RU', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
};

const formatPrice = (price) => {
  return new Intl.NumberFormat('ru-RU').format(price);
};

const getStatusClass = (status) => {
  switch (status) {
    case '–ù–û–í–´–ô':
      return 'status-new';
    case '–û–ü–õ–ê–ß–ï–ù':
      return 'status-paid';
    case '–í–´–ü–û–õ–ù–ï–ù':
      return 'status-delivered';
    case '–û–¢–ú–ï–ù–Å–ù':
      return 'status-cancelled';
    default:
      return '';
  }
};

onMounted(() => {
  loadOrders();
});
</script>

<style scoped>
.orders-page {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
}

.orders-filters {
  margin-bottom: 2rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 8px;
}

.filter-group {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.filter-select {
  padding: 0.5rem;
  border: 1px solid #ddd;
  border-radius: 4px;
  min-width: 200px;
}

.loading, .error, .empty {
  text-align: center;
  padding: 3rem;
  background: #f8f9fa;
  border-radius: 8px;
  margin: 1rem 0;
}

.error {
  color: #dc3545;
}

.empty {
  color: #6c757d;
}

.spinner {
  border: 3px solid #f3f3f3;
  border-top: 3px solid #007bff;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 0 auto 1rem;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.orders-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.order-card {
  background: white;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.order-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid #eee;
}

.order-info h3 {
  margin: 0 0 0.25rem 0;
}

.order-date {
  color: #6c757d;
  font-size: 0.9rem;
}

.status-badge {
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.875rem;
  font-weight: 500;
}

.status-new {
  background: #fff3cd;
  color: #856404;
  border: 1px solid #ffeaa7;
}

.status-paid {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.status-delivered {
  background: #d1ecf1;
  color: #0c5460;
  border: 1px solid #bee5eb;
}

.status-cancelled {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

.order-content {
  display: flex;
  justify-content: space-between;
  margin-bottom: 1rem;
}

.order-items {
  flex: 1;
}

.order-item-preview {
  margin-bottom: 0.5rem;
  display: flex;
  gap: 0.5rem;
}

.item-name {
  color: #333;
}

.item-quantity {
  color: #6c757d;
}

.more-items {
  color: #6c757d;
  font-size: 0.9rem;
  font-style: italic;
}

.order-total {
  text-align: right;
  min-width: 150px;
}

.total-label {
  color: #6c757d;
  font-size: 0.9rem;
}

.total-amount {
  font-size: 1.25rem;
  font-weight: bold;
  color: #28a745;
}

.order-actions {
  display: flex;
  justify-content: flex-end;
  gap: 0.5rem;
  padding-top: 1rem;
  border-top: 1px solid #eee;
}

.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  margin-top: 2rem;
  padding: 1rem;
}

.page-info {
  font-weight: 500;
}
</style>
//src\pages\user\OrdersSubPage.vue
<template>
–ü—É—Å—Ç–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
</template>

<script setup>

</script>

<style scoped>

</style>
//src\pages\user\UserPage.vue
<template>
  <AppHeader/>
  <router-view></router-view>
</template>

<script setup>

import AppHeader from "../../components/layout/AppHeader.vue";
</script>

<style scoped>

</style>
//src\router\index.js
import { createRouter, createWebHistory } from 'vue-router';
import { useAuthStore } from '../stores/auth.js';

const authRoute = {
    path: '/auth',
    name: '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è',
    component: () => import('../pages/AuthPage.vue')
};

const routes = [
    authRoute,
    {
        path: '/',
        component: () => import('../pages/user/UserPage.vue'),
        children: [
            {
                path: 'main',
                name: '–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞',
                component: () => import('../pages/shared/MainSubPage.vue'),
                meta: { requiresAuth: false }
            },
            {
                path: 'profile',
                name: '–ü—Ä–æ—Ñ–∏–ª—å',
                component: () => import('../pages/shared/ProfileSubPage.vue'),
                meta: { requiresAuth: true }
            },
            {
                path: 'cart',
                name: '–ö–æ—Ä–∑–∏–Ω–∞',
                component: () => import('../pages/user/CartSubPage.vue'),
                meta: { requiresAuth: true }
            },
            {
                path: 'checkout',
                name: '–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞',
                component: () => import('../pages/user/CheckoutPage.vue'),
                meta: { requiresAuth: true }
            },
            {
                path: 'orders',
                name: '–ú–æ–∏ –∑–∞–∫–∞–∑—ã',
                component: () => import('../pages/user/OrdersListPage.vue'),
                meta: { requiresAuth: true }
            },
            {
                path: 'orders/:orderId',
                name: '–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞',
                component: () => import('../pages/user/OrderDetailsPage.vue'),
                meta: { requiresAuth: true }
            },
            {
                path: 'product/:productId',
                name: '–ü—Ä–æ–¥—É–∫—Ç—ã',
                component: () => import('../pages/shared/ProductSubPage.vue'),
                meta: { requiresAuth: false }
            },
            {
                path: '',
                redirect: { name: '–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞' }
            }
        ]
    },
    {
        path: '/admin',
        name: '–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å',
        component: () => import('../pages/admin/AdminPage.vue'),
        meta: { requiresAuth: true, requiresAdmin: true },
        children: [
            {
                path: 'profile',
                name: '–ü—Ä–æ—Ñ–∏–ª—å–ê–¥–º–∏–Ω',
                component: () => import('../pages/shared/ProfileSubPage.vue'),
                meta: { requiresAuth: true }
            },
            {
                path: 'products',
                name: '–¢–æ–≤–∞—Ä—ã',
                component: () => import('../pages/admin/ProductsSubPage.vue'),
            },
            {
                path: 'orders',
                name: '–ó–∞–∫–∞–∑—ã',
                component: () => import('../pages/admin/OrdersSubPage.vue'),
            },
            {
                path: 'categories',
                name: '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏',
                component: () => import('../pages/admin/CategoriesSubPage.vue'),
            },
            {
                path: '',
                redirect: { name: '–¢–æ–≤–∞—Ä—ã' }
            },
            {
                path: 'users',
                name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏',
                component: () => import('../pages/admin/UsersSubPage.vue'),
            }
        ]
    },
    {
        // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É    
        path: '/:pathMatch(.*)*',
        redirect: { name: '–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞' }
    }
];

const router = createRouter({
    history: createWebHistory(),
    routes
});

router.beforeEach((to) => {
    const authStore = useAuthStore();

    if (to.name === authRoute.name && authStore.isAuthenticated) {
        return { name: '–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞' };
    }

    if (to.meta.requiresAuth && !authStore.isAuthenticated) {
        return { name: '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' };
    }

    if (to.meta.requiresAdmin && !authStore.isAdmin) {
        return { name: '–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞' };
    }

    return true;
});

export default router;
//src\stores\adminCategories.js
import { defineStore } from 'pinia';
import { ref } from 'vue';
import { adminCategoriesAPI } from '../api/admin.js';

export const useAdminCategoriesStore = defineStore('adminCategories', () => {
    const categories = ref([]);
    const isLoading = ref(false);
    const error = ref(null);

    const loadCategories = async () => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await adminCategoriesAPI.getCategoryTree();
            categories.value = response.categories;
            return { success: true };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const createCategory = async (categoryData) => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await adminCategoriesAPI.createCategory(categoryData);
            // –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            await loadCategories();
            return { success: true, category: response.category };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const updateCategory = async (categoryId, categoryData) => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await adminCategoriesAPI.updateCategory(categoryId, categoryData);
            // –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            await loadCategories();
            return { success: true, category: response.category };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const deleteCategory = async (categoryId) => {
        isLoading.value = true;
        error.value = null;

        try {
            await adminCategoriesAPI.deleteCategory(categoryId);
            // –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            await loadCategories();
            return { success: true };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const clearError = () => {
        error.value = null;
    };

    return {
        categories,
        isLoading,
        error,
        loadCategories,
        createCategory,
        updateCategory,
        deleteCategory,
        clearError
    };
});
//src\stores\adminUsers.js
// src/stores/adminUsers.js
import { defineStore } from 'pinia';
import { ref } from 'vue';
import { adminAPI } from '../api/admin.js';

export const useAdminUsersStore = defineStore('adminUsers', () => {
    const users = ref([]);
    const isLoading = ref(false);
    const error = ref(null);
    const pagination = ref({
        currentPage: 1,
        totalPages: 1,
        total: 0,
        limit: 10
    });
    const searchQuery = ref('');

    const loadUsers = async (page = 1, limit = 10, search = '') => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await adminAPI.getUsers(page, limit, search);
            users.value = response.users;
            pagination.value = {
                currentPage: response.currentPage,
                totalPages: response.totalPages,
                total: response.total,
                limit: limit
            };
            searchQuery.value = search;
            return { success: true };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const updateRole = async (userId, role) => {
        try {
            const response = await adminAPI.updateUserRole(userId, role);

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
            const userIndex = users.value.findIndex(user => user._id === userId);
            if (userIndex !== -1) {
                users.value[userIndex] = response.user;
            }

            return { success: true, user: response.user };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–æ–ª–∏';
            return { success: false, error: error.value };
        }
    };

    const clearError = () => {
        error.value = null;
    };

    return {
        users,
        isLoading,
        error,
        pagination,
        searchQuery,
        loadUsers,
        updateRole,
        clearError
    };
});
//src\stores\auth.js
import { defineStore } from 'pinia';
import { authAPI } from '../api/auth.js';
import { ref, computed } from 'vue';

export const useAuthStore = defineStore('auth', () => {
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ (state)
    const user = ref(null);
    const isLoading = ref(false);
    const error = ref(null);

    // –ì–µ—Ç—Ç–µ—Ä—ã (getters)
    const isAuthenticated = computed(() => !!user.value);
    const isAdmin = computed(() => user.value?.role === '–ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†');
    const userInfo = computed(() => user.value);

    // –î–µ–π—Å—Ç–≤–∏—è (actions)
    const login = async (credentials) => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await authAPI.login(credentials);
            user.value = response.user;
            return { success: true };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const register = async (userData) => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await authAPI.register(userData);
            user.value = response.user;
            return { success: true };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const logout = async () => {
        isLoading.value = true;

        try {
            await authAPI.logout();
            user.value = null;
            error.value = null;
            return { success: true };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const checkAuth = async () => {
        isLoading.value = true;

        try {
            const response = await authAPI.getCurrentUser();
            user.value = response.user;
            return { success: true };
        } catch (err) {
            user.value = null;
            return { success: false };
        } finally {
            isLoading.value = false;
        }
    };

    const clearError = () => {
        error.value = null;
    };

    return {
        // state
        user,
        isLoading,
        error,

        // getters
        isAuthenticated,
        isAdmin,
        userInfo,

        // actions
        login,
        register,
        logout,
        checkAuth,
        clearError
    };
});
//src\stores\cart.js
import { defineStore } from 'pinia';
import { cartAPI } from '../api/cart.js';
import { ref, computed } from 'vue';

export const useCartStore = defineStore('cart', () => {
    const cart = ref(null);
    const isLoading = ref(false);
    const error = ref(null);
    const totalPrice = ref(0);

    const items = computed(() => cart.value?.items || []);
    const isEmpty = computed(() => items.value.length === 0);
    const totalItems = computed(() => cart.value?.totalItems || 0);
    const cartTotalPrice = computed(() => cart.value?.totalPrice || 0);
    const cartCount = computed(() => items.value.length);

    const loadCart = async () => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await cartAPI.getCart();
            cart.value = response;
            cartCount.value = response.totalItems;
            totalPrice.value = response.totalPrice;
            return { success: true };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const addToCart = async (productId, quantity = 1) => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await cartAPI.addToCart(productId, quantity);
            await loadCart(); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ—Ä–∑–∏–Ω—É –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            return { success: true, data: response };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const updateCartItem = async (productId, quantity) => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await cartAPI.updateCartItem(productId, quantity);
            await loadCart(); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ—Ä–∑–∏–Ω—É –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
            return { success: true, data: response };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const removeFromCart = async (productId) => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await cartAPI.removeFromCart(productId);
            await loadCart(); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ—Ä–∑–∏–Ω—É –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
            return { success: true, data: response };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const clearCart = async () => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await cartAPI.clearCart();
            cart.value = null;
            cartCount.value = 0;
            totalPrice.value = 0;
            return { success: true, data: response };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const getCartItem = (productId) => {
        return items.value.find(item => item.productId === productId);
    };

    const clearError = () => {
        error.value = null;
    };

    return {
        cart,
        items,
        isLoading,
        error,
        cartCount,
        totalPrice,
        isEmpty,
        totalItems,
        cartTotalPrice,

        loadCart,
        addToCart,
        updateCartItem,
        removeFromCart,
        clearCart,
        getCartItem,
        clearError
    };
});
//src\stores\orders.js
import { defineStore } from 'pinia';
import { ordersAPI } from '../api/orders.js';
import { ref, computed } from 'vue';

export const useOrdersStore = defineStore('orders', () => {
    const orders = ref([]);
    const currentOrder = ref(null);
    const isLoading = ref(false);
    const error = ref(null);
    const pagination = ref({
        currentPage: 1,
        totalPages: 1,
        total: 0,
        limit: 10
    });

    const orderStatuses = {
        NEW: '–ù–û–í–´–ô',
        PAID: '–û–ü–õ–ê–ß–ï–ù',
        DELIVERED: '–í–´–ü–û–õ–ù–ï–ù',
        CANCELLED: '–û–¢–ú–ï–ù–Å–ù'
    };

    const loadOrders = async (page = 1, limit = 10, status = '') => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await ordersAPI.getOrders(page, limit, status);
            orders.value = response.orders;
            pagination.value = {
                currentPage: response.currentPage,
                totalPages: response.totalPages,
                total: response.total,
                limit: limit
            };
            return { success: true };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const loadOrder = async (orderId) => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await ordersAPI.getOrder(orderId);
            currentOrder.value = response.order;
            return { success: true };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–∞';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const createOrderFromCart = async () => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await ordersAPI.createOrder({});
            return { success: true, order: response.order };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const updateOrder = async (orderId, orderData) => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await ordersAPI.updateOrder(orderId, orderData);
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–∫–∞–∑ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
            if (currentOrder.value && currentOrder.value._id === orderId) {
                currentOrder.value = response.order;
            }
            return { success: true, order: response.order };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const payOrder = async (orderId, paymentData) => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await ordersAPI.payOrder(orderId, paymentData);
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–∫–∞–∑ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
            if (currentOrder.value && currentOrder.value._id === orderId) {
                currentOrder.value = response.order;
            }
            return { success: true, order: response.order };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–∞';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const cancelOrder = async (orderId) => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await ordersAPI.cancelOrder(orderId);
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–∫–∞–∑ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
            if (currentOrder.value && currentOrder.value._id === orderId) {
                currentOrder.value = response.order;
            }
            return { success: true };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const clearError = () => {
        error.value = null;
    };

    const canEditOrder = computed(() => {
        if (!currentOrder.value) return false;

        const status = currentOrder.value.status;
        return status === orderStatuses.NEW || status === orderStatuses.PAID;
    });

    const canEditDelivery = computed(() => {
        if (!currentOrder.value) return false;

        const status = currentOrder.value.status;
        return status === orderStatuses.NEW || status === orderStatuses.PAID;
    });

    const canEditPayment = computed(() => {
        if (!currentOrder.value) return false;

        return currentOrder.value.status === orderStatuses.NEW;
    });

    const canCancelOrder = computed(() => {
        if (!currentOrder.value) return false;

        return currentOrder.value.status === orderStatuses.NEW;
    });

    return {
        orders,
        currentOrder,
        isLoading,
        error,
        pagination,
        orderStatuses,
        loadOrders,
        loadOrder,
        createOrderFromCart,
        updateOrder,
        payOrder,
        cancelOrder,
        clearError,
        canEditOrder,
        canEditDelivery,
        canEditPayment,
        canCancelOrder
    };
});
//src\stores\product.js
import { defineStore } from 'pinia';
import { productAPI } from '../api/product.js';
import { ref, computed } from 'vue';

export const useProductStore = defineStore('product', () => {
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ (state)
    const products = ref([]);
    const isLoading = ref(false);
    const error = ref(null);

    // –ì–µ—Ç—Ç–µ—Ä—ã (getters)

    // –î–µ–π—Å—Ç–≤–∏—è (actions)
    const getAllProducts = async () => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await productAPI.getAllProducts();
            products.value = response.products;
            return { success: true };
        } catch (err) {
            error.value = err.message || '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤';
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const getOneProduct = async (productId) => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await productAPI.getOneProduct(productId);
            return { success: true, value: response.product };
        } catch (err) {
            error.value = err.message || `–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º ${productId}`;
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const getProductsFromCategories = async (categoriesId) => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await productAPI.getProductsFromCategories(categoriesId);
            return { success: true, value: response.products };
        } catch (err) {
            error.value = err.message || `–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ${categoriesId}`;
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    };

    const findProducts = async (searchString, categoriesId) => {
        isLoading.value = true;
        error.value = null;

        try {
            const response = await productAPI.findProducts(searchString, categoriesId);
            return { success: true, value: response.products };
        } catch (err) {
            error.value = err.message || `–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å—É ${searchString}`;
            return { success: false, error: error.value };
        } finally {
            isLoading.value = false;
        }
    }

    return {
        // state
        isLoading,
        error,
        products,

        // getters

        // actions
        getAllProducts,
        getOneProduct,
        getProductsFromCategories,
        findProducts
    };
});
//vite.config.js
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  server: {
    port: 3000, // –ö–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 3000 –ø–æ—Ä—Ç—É
    proxy: {
      // –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –±—ç–∫–µ–Ω–¥-—Å–µ—Ä–≤–µ—Ä
      '/api': {
        target: 'http://localhost:5000', // –í–∞—à Express —Å–µ—Ä–≤–µ—Ä
        changeOrigin: true
      }
    }
  },
  build: {
    outDir: '../server/public' // –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –±–∏–ª–¥ –≤ –ø–∞–ø–∫—É —Å–µ—Ä–≤–µ—Ä–∞
  }
})
